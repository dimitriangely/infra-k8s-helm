Windows PowerShell
Copyright (C) Microsoft Corporation. Tous droits réservés.

Installez la dernière version de PowerShell pour de nouvelles fonctionnalités et améliorations ! https://aka.ms/PSWindows

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent> mkdir tp-k8s-microservices


    Répertoire: C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:34                tp-k8s-microservices


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent> cd tp-k8s-microservices
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir 01-compose-analysis


    Répertoire: C:\Users\Dimitri
    ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:35                01-compose-analysis


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir 02-images


    Répertoire: C:\Users\Dimitri
    ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:35                02-images


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir 03-k8s-manifests


    Répertoire: C:\Users\Dimitri
    ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:35                03-k8s-manifests


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir 04-helm-chart


    Répertoire: C:\Users\Dimitri
    ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:35                04-helm-chart


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir 05-tests


    Répertoire: C:\Users\Dimitri
    ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:35                05-tests


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir docs


    Répertoire: C:\Users\Dimitri
    ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:35                docs


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir 02-images\scripts


    Répertoire: C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent
    \tp-k8s-microservices\02-images


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:35                scripts


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir 03-k8s-manifests\base


    Répertoire: C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent
    \tp-k8s-microservices\03-k8s-manifests


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:35                base


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir 03-k8s-manifests\apps


    Répertoire: C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent
    \tp-k8s-microservices\03-k8s-manifests


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:35                apps


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir 03-k8s-manifests\infra


    Répertoire: C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent
    \tp-k8s-microservices\03-k8s-manifests


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:35                infra


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir 03-k8s-manifests\security


    Répertoire: C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent
    \tp-k8s-microservices\03-k8s-manifests


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:35                security


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir 03-k8s-manifests\observability


    Répertoire: C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent
    \tp-k8s-microservices\03-k8s-manifests


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:35                observability


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir 03-k8s-manifests\logging


    Répertoire: C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent
    \tp-k8s-microservices\03-k8s-manifests


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:35                logging


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> New-Item -ItemType File -Path .\README.md -Force | Out-Null
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> New-Item -ItemType File -Path .\01-compose-analysis\README.md -Force | Out-Null
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> New-Item -ItemType File -Path .\02-images\README.md -Force | Out-Null
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> New-Item -ItemType File -Path .\03-k8s-manifests\README.md -Force | Out-Null
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> New-Item -ItemType File -Path .\04-helm-chart\README.md -Force | Out-Null
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> New-Item -ItemType File -Path .\05-tests\README.md -Force | Out-Null
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> New-Item -ItemType File -Path .\docs\README.md -Force | Out-Null
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git init
Initialized empty Git repository in C:/Users/Dimitri ANGELY/Desktop/laboratoire/Leclerc-vincent/tp-k8s-microservices/.git/
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git branch -M main
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git commit -m "initialisation de la structure du projet"
[main (root-commit) 47fa21f] initialisation de la structure du projet
 8 files changed, 30 insertions(+)
 create mode 100644 .gitignore
 create mode 100644 01-compose-analysis/README.md
 create mode 100644 02-images/README.md
 create mode 100644 03-k8s-manifests/README.md
 create mode 100644 04-helm-chart/README.md
 create mode 100644 05-tests/README.md
 create mode 100644 README.md
 create mode 100644 docs/README.md
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> tree /F
Structure du dossier pour le volume OS
Le numéro de série du volume est DA3F-C2F5
C:.
│   .gitignore
│   README.md
│
├───01-compose-analysis
│       README.md
│
├───02-images
│   │   README.md
│   │
│   └───scripts
├───03-k8s-manifests
│   │   README.md
│   │
│   ├───apps
│   ├───base
│   ├───infra
│   ├───logging
│   ├───observability
│   └───security
├───04-helm-chart
│       README.md
│
├───05-tests
│       README.md
│
└───docs
        README.md

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir src


    Répertoire: C:\Users\Dimitri
    ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:43                src


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> cd .\src
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src> git clone https://github.com/bart120/m2cloud.git
Cloning into 'm2cloud'...
remote: Enumerating objects: 310, done.
remote: Counting objects: 100% (310/310), done.
remote: Compressing objects: 100% (238/238), done.
remote: Total 310 (delta 58), reused 299 (delta 47), pack-reused 0 (from 0)
Receiving objects: 100% (310/310), 2.51 MiB | 21.27 MiB/s, done.
Resolving deltas: 100% (58/58), done.
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src> cd ..
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> Get-ChildItem -Path .\src -Recurse -Filter docker-compose.yml


    Répertoire: C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent
    \tp-k8s-microservices\src\m2cloud\compose


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        23/12/2025     19:49           1332 docker-compose.yml


    Répertoire: C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent
    \tp-k8s-microservices\src\m2cloud\projet_k8s\appscore


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        23/12/2025     19:49           1793 docker-compose.yml


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> New-Item -ItemType File -Path .\01-compose-analysis\compose-notes.md -Force | Out-Null
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .
warning: adding embedded git repository: src/m2cloud
hint: You've added another git repository inside your current repository.
hint: Clones of the outer repository will not contain the contents of
hint: the embedded repository and will not know how to obtain it.
hint: If you meant to add a submodule, use:
hint:
hint:   git submodule add <url> src/m2cloud
hint:
hint: If you added this path by mistake, you can remove it from the
hint: index with:
hint:
hint:   git rm --cached src/m2cloud
hint:
hint: See "git help submodule" for more information.
hint: Disable this message with "git config advice.addEmbeddedRepo false"
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> Add-Content -Encoding UTF8 .\.gitignore "`n# Course sources`nsrc/`n"
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .
warning: in the working copy of '.gitignore', LF will be replaced by CRLF the next time Git touches it
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git commit -m "ajout des éléments de cours (parti developpeur) au dossier src"
[main 00fd976] ajout des éléments de cours (parti developpeur) au dossier src
 4 files changed, 21 insertions(+)
 create mode 100644 01-compose-analysis/compose-notes.md
 create mode 160000 src/m2cloud
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> Get-ChildItem -Path .\src -Recurse -Filter docker-compose.yml


    Répertoire: C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent
    \tp-k8s-microservices\src\m2cloud\compose


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        23/12/2025     19:49           1332 docker-compose.yml


    Répertoire: C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent
    \tp-k8s-microservices\src\m2cloud\projet_k8s\appscore


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        23/12/2025     19:49           1793 docker-compose.yml


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> (Get-Content .\src\m2cloud\compose\docker-compose.yml) | Select-String "^\s{0,2}[a-zA-Z0-9_.-]+:\s*$"

networks:
  backend:
  frontend:
volumes:
  mysql_data:
services:
  database:
  myadmin:
  wordpress:


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> (Get-Content .\src\m2cloud\projet_k8s\appscore\docker-compose.yml) | Select-String "^\s{0,2}[a-zA-Z0-9_.-]+:\s*$"

services:
  user.data:
  rabbitmq:
  webmvc:
  applicants.api:
  jobs.api:
  identity.api:
  sql.data:


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir .\01-compose-analysis\compose-source


    Répertoire: C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent
    \tp-k8s-microservices\01-compose-analysis


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:56                compose-source


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> Copy-Item .\src\m2cloud\projet_k8s\appscore\docker-compose.yml .\01-compose-analysis\compose-source\docker-compose.yml -Force
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> Get-Content .\01-compose-analysis\compose-source\docker-compose.yml -TotalCount 30
version: '3'

services:
  user.data:
    image: redis
    ports:
      - 6379:6379

  rabbitmq:
    image: rabbitmq:3-management
    ports:
      - 15672:15672
      - 5672:5672
    container_name: rabbitmq

  webmvc:
    image: web
    build:
      context: ./
      dockerfile: Web/Dockerfile
    ports:
    - 8080:80
    container_name: web
    depends_on:
      - applicants.api
      - identity.api
      - jobs.api
    restart: always

  applicants.api:
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .\01-compose-analysis\compose-source\docker-compose.yml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .\01-compose-analysis\compose-notes.md
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git commit -m "ajout du bon docker-compose pour analyse"
[main 6207b7e] ajout du bon docker-compose pour analyse
 1 file changed, 84 insertions(+)
 create mode 100644 01-compose-analysis/compose-source/docker-compose.yml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> Get-Content .\01-compose-analysis\compose-source\docker-compose.yml

version: '3'

services:
  user.data:
    image: redis
    ports:
      - 6379:6379

  rabbitmq:
    image: rabbitmq:3-management
    ports:
      - 15672:15672
      - 5672:5672
    container_name: rabbitmq

  webmvc:
    image: web
    build:
      context: ./
      dockerfile: Web/Dockerfile
    ports:
    - 8080:80
    container_name: web
    depends_on:
      - applicants.api
      - identity.api
      - jobs.api
    restart: always

  applicants.api:
    image: applicants.api
    environment:
      - ConnectionString=Server=sql.data;User=sa;Password=Pass@word;Database=dotnetgigs.applicants;
      - HostRabbitmq=rabbitmq
    build:
      context: ./
      dockerfile: Services/Applicants.Api/Dockerfile
    ports:
    - 8081:80
    container_name: applicants.api
    depends_on:
      - sql.data
      - rabbitmq
    restart: always

  jobs.api:
    image: jobs.api
    environment:
      - ConnectionString=Server=sql.data;User=sa;Password=Pass@word;Database=dotnetgigs.jobs;
      - HostRabbitmq=rabbitmq
    build:
      context: ./
      dockerfile: Services/Jobs.Api/Dockerfile
    ports:
    - 8083:80
    container_name: jobs.api
    depends_on:
      - sql.data
      - rabbitmq
    restart: always

  identity.api:
    image: identity.api
    environment:
      - RedisHost=user.data:6379
      - HostRabbitmq=rabbitmq
    build:
      context: ./
      dockerfile: Services/Identity.Api/Dockerfile
    ports:
    - 8084:80
    container_name: identity.api
    depends_on:
      - user.data
      - rabbitmq

  sql.data:
    image: mssql-linux
    build:
      context: ./Database
      dockerfile: Dockerfile
    ports:
      - 1433:1433
    container_name: mssql-linux
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> @"
>> # Analyse docker-compose (source officielle)
>>
>> Fichier: 01-compose-analysis/compose-source/docker-compose.yml
>>
>> ## 1) Liste des services
>> - user.data (redis)
>> - rabbitmq (rabbitmq:3-management)
>> - webmvc (web)
>> - applicants.api
>> - jobs.api
>> - identity.api
>> - sql.data (mssql-linux)
>>
>> ## 2) Ports exposés (compose -> externe)
>> - user.data: 6379 -> 6379
>> - rabbitmq: 15672 -> 15672 (UI), 5672 -> 5672 (AMQP)
>> - webmvc: 8080 -> 80
>> - applicants.api: 8081 -> 80
>> - jobs.api: 8083 -> 80
>> - identity.api: 8084 -> 80
>> - sql.data: 1433 -> 1433
>>
>> ## 3) Dépendances (depends_on)
>> - webmvc dépend de: applicants.api, identity.api, jobs.api
>> - applicants.api dépend de: sql.data, rabbitmq
>> - jobs.api dépend de: sql.data, rabbitmq
>> - identity.api dépend de: user.data, rabbitmq
>>
>> ## 4) Variables d'environnement (à reproduire en ConfigMap/Secret)
>> ### applicants.api
>> - ConnectionString=Server=sql.data;User=sa;Password=Pass@word;Database=dotnetgigs.applicants;
>> - HostRabbitmq=rabbitmq
>>
>> ### jobs.api
>> - ConnectionString=Server=sql.data;User=sa;Password=Pass@word;Database=dotnetgigs.jobs;
>> - HostRabbitmq=rabbitmq
>>
>> ### identity.api
>> - RedisHost=user.data:6379
>> - HostRabbitmq=rabbitmq
>>
>> ## 5) Implications Kubernetes (traduction)
>> - Les noms utilisés (sql.data, rabbitmq, user.data) deviendront des DNS de Services Kubernetes.
>> - Les APIs n'ont pas besoin d'être exposées publiquement : Services internes (ClusterIP).
>> - Seule l'app web (webmvc) doit être exposée via Ingress (HTTPS).
>> - Le mot de passe SQL (Pass@word) doit aller dans un Secret (pas en clair).
>> - Redis + MSSQL + RabbitMQ : idéalement avec stockage persistant (PVC) en prod-like.
>> "@ | Set-Content -Encoding UTF8 .\01-compose-analysis\compose-notes.md
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> Get-Content .\01-compose-analysis\compose-notes.md
# Analyse docker-compose (source officielle)

Fichier: 01-compose-analysis/compose-source/docker-compose.yml

## 1) Liste des services
- user.data (redis)
- rabbitmq (rabbitmq:3-management)
- webmvc (web)
- applicants.api
- jobs.api
- identity.api
- sql.data (mssql-linux)

## 2) Ports exposés (compose -> externe)
- user.data: 6379 -> 6379
- rabbitmq: 15672 -> 15672 (UI), 5672 -> 5672 (AMQP)
- webmvc: 8080 -> 80
- applicants.api: 8081 -> 80
- jobs.api: 8083 -> 80
- identity.api: 8084 -> 80
- sql.data: 1433 -> 1433

## 3) Dépendances (depends_on)
- webmvc dépend de: applicants.api, identity.api, jobs.api
- applicants.api dépend de: sql.data, rabbitmq
- jobs.api dépend de: sql.data, rabbitmq
- identity.api dépend de: user.data, rabbitmq

## 4) Variables d'environnement (à reproduire en ConfigMap/Secret)
### applicants.api
- ConnectionString=Server=sql.data;User=sa;Password=Pass@word;Database=dotnetgigs.applicants;
- HostRabbitmq=rabbitmq

### jobs.api
- ConnectionString=Server=sql.data;User=sa;Password=Pass@word;Database=dotnetgigs.jobs;
- HostRabbitmq=rabbitmq

### identity.api
- RedisHost=user.data:6379
- HostRabbitmq=rabbitmq

## 5) Implications Kubernetes (traduction)
- Les noms utilisés (sql.data, rabbitmq, user.data) deviendront des DNS de Services Kubernetes.
- Les APIs n'ont pas besoin d'être exposées publiquement : Services internes (ClusterIP).
- Seule l'app web (webmvc) doit être exposée via Ingress (HTTPS).
- Le mot de passe SQL (Pass@word) doit aller dans un Secret (pas en clair).
- Redis + MSSQL + RabbitMQ : idéalement avec stockage persistant (PVC) en prod-like.
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> Add-Content -Encoding UTF8 .\01-compose-analysis\compose-notes.md @"
>>
>> ## 6) Schéma des communications (simplifié)
>>
>> Internet (HTTPS)
>>    |
>>    v
>> [ Ingress ] -> [ webmvc ]
>>                 | \
>>                 |  \
>>                 v   v
>>         [ applicants.api ]   [ jobs.api ]
>>                 \             /
>>                  \           /
>>                   v         v
>>                    [ sql.data ]
>>
>> [ identity.api ] -> [ user.data (redis) ]
>>
>> Tous (web + APIs) utilisent aussi:
>> - rabbitmq (AMQP 5672)
>> - UI RabbitMQ (15672) uniquement si besoin admin
>>
>> "@
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> Add-Content -Encoding UTF8 .\01-compose-analysis\compose-notes.md @"
>>
>> ## 7) Décisions Kubernetes (choix projet)
>>
>> Namespace:
>> - tp-prod
>>
>> Exposition externe:
>> - webmvc: OUI (Ingress HTTPS)
>> - applicants.api: NON (interne)
>> - jobs.api: NON (interne)
>> - identity.api: NON (interne)
>> - rabbitmq UI (15672): NON par défaut (optionnel via port-forward)
>> - sql.data / redis: NON (interne)
>>
>> Type de workload:
>> - webmvc / applicants.api / jobs.api / identity.api: Deployment
>> - rabbitmq: Deployment (ou StatefulSet si persistance)
>> - user.data (redis): Deployment (ou StatefulSet si persistance)
>> - sql.data (mssql): StatefulSet + PVC (recommandé)
>>
>> Secrets:
>> - SQL SA password: Secret Kubernetes
>> "@
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .\01-compose-analysis\compose-notes.md
warning: in the working copy of '01-compose-analysis/compose-notes.md', LF will be replaced by CRLF the next time Git touches it
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git commit -m "analyse des dependances du docker-compose, des ports et de l'environnement global"
[main af7707a] analyse des dependances du docker-compose, des ports et de l'environnement global
 1 file changed, 91 insertions(+)
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> Get-ChildItem .\src\m2cloud\projet_k8s\appscore -Recurse -Filter Dockerfile | Select-Object FullName

FullName
--------
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore\Database\Dockerfile
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore\Services\Applicants.Api\Dockerfile
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore\Services\Identity.Api\Dockerfile
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore\Services\Jobs.Api\Dockerfile
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore\Web\Dockerfile


PS C:\UseGet-ChildItem .\src\m2cloud\projet_k8s\appscore -Recurse -File -Filter Dockerfile | Select-Object FullName

FullName
--------
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore\Database\Dockerfile
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore\Services\Applicants.Api\Dockerfile
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore\Services\Identity.Api\Dockerfile
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore\Services\Jobs.Api\Dockerfile
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore\Web\Dockerfile


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> cd .\src\m2cloud\projet_k8s\appscore
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker version
Client:
 Version:           28.5.2
 API version:       1.51
 Go version:        go1.25.3
 Git commit:        ecc6942
 Built:             Wed Nov  5 14:45:58 2025
 OS/Arch:           windows/amd64
 Context:           desktop-linux

Server: Docker Desktop 4.51.0 (210443)
 Engine:
  Version:          28.5.2
  API version:      1.51 (minimum version 1.24)
  Go version:       go1.25.3
  Git commit:       89c5e8f
  Built:            Wed Nov  5 14:43:25 2025
  OS/Arch:          linux/amd64
  Experimental:     false
 containerd:
  Version:          v1.7.29
  GitCommit:        442cb34bda9a6a0fed82a2ca7cade05c5c749582
 runc:
  Version:          1.3.3
  GitCommit:        v1.3.3-0-gd842d771
 docker-init:
  Version:          0.19.0
  GitCommit:        de40ad0
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker info
Client:
 Version:    28.5.2
 Context:    desktop-linux
 Debug Mode: false
 Plugins:
  ai: Docker AI Agent - Ask Gordon (Docker Inc.)
    Version:  v1.9.11
    Path:     C:\Program Files\Docker\cli-plugins\docker-ai.exe
  buildx: Docker Buildx (Docker Inc.)
    Version:  v0.29.1-desktop.1
    Path:     C:\Program Files\Docker\cli-plugins\docker-buildx.exe
  compose: Docker Compose (Docker Inc.)
    Version:  v2.40.3-desktop.1
    Path:     C:\Program Files\Docker\cli-plugins\docker-compose.exe
  debug: Get a shell into any image or container (Docker Inc.)
    Version:  0.0.45
    Path:     C:\Program Files\Docker\cli-plugins\docker-debug.exe
  desktop: Docker Desktop commands (Docker Inc.)
    Version:  v0.2.0
    Path:     C:\Program Files\Docker\cli-plugins\docker-desktop.exe
  extension: Manages Docker extensions (Docker Inc.)
    Version:  v0.2.31
    Path:     C:\Program Files\Docker\cli-plugins\docker-extension.exe
  init: Creates Docker-related starter files for your project (Docker Inc.)
    Version:  v1.4.0
    Path:     C:\Program Files\Docker\cli-plugins\docker-init.exe
  mcp: Docker MCP Plugin (Docker Inc.)
    Version:  v0.27.0
    Path:     C:\Program Files\Docker\cli-plugins\docker-mcp.exe
  model: Docker Model Runner (Docker Inc.)
    Version:  v0.1.46
    Path:     C:\Program Files\Docker\cli-plugins\docker-model.exe
  offload: Docker Offload (Docker Inc.)
    Version:  v0.5.17
    Path:     C:\Program Files\Docker\cli-plugins\docker-offload.exe
  sandbox: Docker Sandbox (Docker Inc.)
    Version:  v0.5.3
    Path:     C:\Program Files\Docker\cli-plugins\docker-sandbox.exe
  sbom: View the packaged-based Software Bill Of Materials (SBOM) for an image (Anchore Inc.)
    Version:  0.6.0
    Path:     C:\Program Files\Docker\cli-plugins\docker-sbom.exe
  scout: Docker Scout (Docker Inc.)
    Version:  v1.18.3
    Path:     C:\Program Files\Docker\cli-plugins\docker-scout.exe

Server:
 Containers: 11
  Running: 0
  Paused: 0
  Stopped: 11
 Images: 51
 Server Version: 28.5.2
 Storage Driver: overlayfs
  driver-type: io.containerd.snapshotter.v1
 Logging Driver: json-file
 Cgroup Driver: cgroupfs
 Cgroup Version: 2
 Plugins:
  Volume: local
  Network: bridge host ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file local splunk syslog
 CDI spec directories:
  /etc/cdi
  /var/run/cdi
 Discovered Devices:
  cdi: docker.com/gpu=webgpu
 Swarm: inactive
 Runtimes: runc io.containerd.runc.v2 nvidia
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: 442cb34bda9a6a0fed82a2ca7cade05c5c749582
 runc version: v1.3.3-0-gd842d771
 init version: de40ad0
 Security Options:
  seccomp
   Profile: builtin
  cgroupns
 Kernel Version: 6.6.87.2-microsoft-standard-WSL2
 Operating System: Docker Desktop
 OSType: linux
 Architecture: x86_64
 CPUs: 20
 Total Memory: 31.19GiB
 Name: docker-desktop
 ID: 1a234cd4-caef-474b-9d54-d20bb6fcefa6
 Docker Root Dir: /var/lib/docker
 Debug Mode: false
 HTTP Proxy: http.docker.internal:3128
 HTTPS Proxy: http.docker.internal:3128
 No Proxy: hubproxy.docker.internal
 Labels:
  com.docker.desktop.address=npipe://\\.\pipe\docker_cli
 Experimental: false
 Insecure Registries:
  hubproxy.docker.internal:5555
  ::1/128
  127.0.0.0/8
 Live Restore Enabled: false

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker build -t web -f .\Web\Dockerfile .
[+] Building 44.7s (19/19) FINISHED                    docker:desktop-linux
 => [internal] load build definition from Dockerfile                   0.1s
 => => transferring dockerfile: 600B                                   0.0s
 => [internal] load metadata for mcr.microsoft.com/dotnet/core/sdk:2.  0.6s
 => [internal] load metadata for mcr.microsoft.com/dotnet/core/aspnet  0.6s
 => [internal] load .dockerignore                                      0.0s
 => => transferring context: 2B                                        0.0s
 => [internal] load build context                                      0.8s
 => => transferring context: 2.47MB                                    0.7s
 => [build 1/8] FROM mcr.microsoft.com/dotnet/core/sdk:2.1-stretch@s  25.7s
 => => resolve mcr.microsoft.com/dotnet/core/sdk:2.1-stretch@sha256:a  0.0s
 => => sha256:d22db8cd915ea0c1414de6e2823aa0c47c 303.36MB / 303.36MB  20.0s
 => => sha256:6e1ebcd381250104f4231c05eaba5a6323 171.29MB / 171.29MB  10.3s
 => => sha256:fa5b7de410ab6a1c3e586b9befec99899a563 13.25MB / 13.25MB  1.2s
 => => sha256:c19c058edda50f20bd5b06380342e9d99f713 49.76MB / 49.76MB  3.8s
 => => sha256:4ae15c65bfa0fdc9053dcb734e6c034f5394ea0 4.34MB / 4.34MB  0.6s
 => => sha256:83600c1b4583abb5830c6d4a039cbab9a102a 11.30MB / 11.30MB  0.9s
 => => sha256:eb18d230e067c240479c6a3f842e7f9d4ff10 45.38MB / 45.38MB  2.9s
 => => extracting sha256:eb18d230e067c240479c6a3f842e7f9d4ff1088e3072  1.1s
 => => extracting sha256:83600c1b4583abb5830c6d4a039cbab9a102ac1a7b3b  0.2s
 => => extracting sha256:4ae15c65bfa0fdc9053dcb734e6c034f5394ea0481de  0.1s
 => => extracting sha256:c19c058edda50f20bd5b06380342e9d99f7138770d79  1.2s
 => => extracting sha256:fa5b7de410ab6a1c3e586b9befec99899a563e090672  0.2s
 => => extracting sha256:6e1ebcd381250104f4231c05eaba5a632388f249c644  1.3s
 => => extracting sha256:d22db8cd915ea0c1414de6e2823aa0c47cedda498400  4.8s
 => [base 1/2] FROM mcr.microsoft.com/dotnet/core/aspnet:2.1-stretch-  5.7s
 => => resolve mcr.microsoft.com/dotnet/core/aspnet:2.1-stretch-slim@  0.0s
 => => sha256:2b463c1ef5a97bea188f214519fec9d82d0e4 17.67MB / 17.67MB  1.6s
 => => sha256:f66af433fc3eabe3694f2bd46f6936aadb99adf 2.99MB / 2.99MB  0.7s
 => => sha256:06e05c6a34c19717d50d6de009d20a269e522 60.13MB / 60.13MB  4.7s
 => => sha256:33f99cea3b7da8c6e0143c9fd7590c6d56f7d 22.53MB / 22.53MB  1.9s
 => => extracting sha256:33f99cea3b7da8c6e0143c9fd7590c6d56f7d310ddd5  0.9s
 => => extracting sha256:2b463c1ef5a97bea188f214519fec9d82d0e411e6d47  0.3s
 => => extracting sha256:f66af433fc3eabe3694f2bd46f6936aadb99adf45275  0.1s
 => => extracting sha256:06e05c6a34c19717d50d6de009d20a269e522e8cfef2  0.7s
 => [base 2/2] WORKDIR /app                                            0.8s
 => [final 1/2] WORKDIR /app                                           0.2s
 => [build 2/8] WORKDIR /src                                           2.9s
 => [build 3/8] COPY Web Web/                                          0.1s
 => [build 4/8] COPY Foundation/Http Foundation/Http/                  0.0s
 => [build 5/8] RUN dotnet restore "Web/Web.csproj"                    3.9s
 => [build 6/8] COPY . .                                               0.2s
 => [build 7/8] WORKDIR /src/Web                                       0.0s
 => [build 8/8] RUN dotnet build "Web.csproj" -c Release -o /app/buil  2.7s
 => [publish 1/1] RUN dotnet publish "Web.csproj" -c Release -o /app/  6.0s
 => [final 2/2] COPY --from=publish /app/publish .                     0.3s
 => exporting to image                                                 1.7s
 => => exporting layers                                                1.2s
 => => exporting manifest sha256:b161d1b4839ee5b805b3748cfd52f53fef76  0.0s
 => => exporting config sha256:7a2066840619504009bf6c4dddee3f540af4b7  0.0s
 => => exporting attestation manifest sha256:439ec557fc30be39676daacf  0.0s
 => => exporting manifest list sha256:23d3f97e6e44e74d73f7fd9d43f28fe  0.0s
 => => naming to docker.io/library/web:latest                          0.0s
 => => unpacking to docker.io/library/web:latest                       0.4s

View build details: docker-desktop://dashboard/build/desktop-linux/desktop-linux/zsdml5wra68pyjo12qxtywpkf
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker build -t applicants.api -f .\Services\Applicants.Api\Dockerfile .
[+] Building 16.4s (19/19) FINISHED                    docker:desktop-linux
 => [internal] load build definition from Dockerfile                   0.0s
 => => transferring dockerfile: 728B                                   0.0s
 => [internal] load metadata for mcr.microsoft.com/dotnet/core/aspnet  0.2s
 => [internal] load metadata for mcr.microsoft.com/dotnet/core/sdk:2.  0.2s
 => [internal] load .dockerignore                                      0.0s
 => => transferring context: 2B                                        0.0s
 => [build 1/8] FROM mcr.microsoft.com/dotnet/core/sdk:2.1-stretch@sh  0.0s
 => => resolve mcr.microsoft.com/dotnet/core/sdk:2.1-stretch@sha256:a  0.0s
 => [internal] load build context                                      0.0s
 => => transferring context: 9.56kB                                    0.0s
 => [base 1/2] FROM mcr.microsoft.com/dotnet/core/aspnet:2.1-stretch-  0.0s
 => => resolve mcr.microsoft.com/dotnet/core/aspnet:2.1-stretch-slim@  0.0s
 => CACHED [build 2/8] WORKDIR /src                                    0.0s
 => [build 3/8] COPY Services/Applicants.Api Services/Applicants.Api/  0.1s
 => [build 4/8] COPY Foundation/Events Foundation/Events/              0.1s
 => [build 5/8] RUN dotnet restore "Services/Applicants.Api/applicant  7.3s
 => [build 6/8] COPY . .                                               0.2s
 => [build 7/8] WORKDIR /src/Services/Applicants.Api                   0.1s
 => [build 8/8] RUN dotnet build "applicants.api.csproj" -c Release -  2.2s
 => [publish 1/1] RUN dotnet publish "applicants.api.csproj" -c Relea  4.3s
 => CACHED [base 2/2] WORKDIR /app                                     0.0s
 => CACHED [final 1/2] WORKDIR /app                                    0.0s
 => [final 2/2] COPY --from=publish /app/publish .                     0.1s
 => exporting to image                                                 1.4s
 => => exporting layers                                                1.1s
 => => exporting manifest sha256:b365b84adee16a8fbf3965003efb8cf1c4d6  0.0s
 => => exporting config sha256:e56ca480d6e7a82ff2a883f0887418b7de5c1f  0.0s
 => => exporting attestation manifest sha256:cc6ed0d5678fc0af6056a48d  0.0s
 => => exporting manifest list sha256:57476b15eb2c0480541b1a5a215d84a  0.0s
 => => naming to docker.io/library/applicants.api:latest               0.0s
 => => unpacking to docker.io/library/applicants.api:latest            0.2s

View build details: docker-desktop://dashboard/build/desktop-linux/desktop-linux/ylg92m0v5m1k5z1hem8rsoveo
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker build -t jobs.api -f .\Services\Jobs.Api\Dockerfile .
[+] Building 14.5s (19/19) FINISHED                    docker:desktop-linux
 => [internal] load build definition from Dockerfile                   0.0s
 => => transferring dockerfile: 680B                                   0.0s
 => [internal] load metadata for mcr.microsoft.com/dotnet/core/aspnet  0.1s
 => [internal] load metadata for mcr.microsoft.com/dotnet/core/sdk:2.  0.1s
 => [internal] load .dockerignore                                      0.0s
 => => transferring context: 2B                                        0.0s
 => [build 1/8] FROM mcr.microsoft.com/dotnet/core/sdk:2.1-stretch@sh  0.0s
 => => resolve mcr.microsoft.com/dotnet/core/sdk:2.1-stretch@sha256:a  0.0s
 => [internal] load build context                                      0.0s
 => => transferring context: 9.56kB                                    0.0s
 => [base 1/2] FROM mcr.microsoft.com/dotnet/core/aspnet:2.1-stretch-  0.0s
 => => resolve mcr.microsoft.com/dotnet/core/aspnet:2.1-stretch-slim@  0.0s
 => CACHED [build 2/8] WORKDIR /src                                    0.0s
 => [build 3/8] COPY Services/Jobs.Api Services/Jobs.Api/              0.1s
 => [build 4/8] COPY Foundation/Events Foundation/Events/              0.0s
 => [build 5/8] RUN dotnet restore "Services/Jobs.Api/jobs.api.csproj  5.8s
 => [build 6/8] COPY . .                                               0.1s
 => [build 7/8] WORKDIR /src/Services/Jobs.Api                         0.0s
 => [build 8/8] RUN dotnet build "jobs.api.csproj" -c Release -o /app  2.2s
 => [publish 1/1] RUN dotnet publish "jobs.api.csproj" -c Release -o   4.1s
 => CACHED [base 2/2] WORKDIR /app                                     0.0s
 => CACHED [final 1/2] WORKDIR /app                                    0.0s
 => [final 2/2] COPY --from=publish /app/publish .                     0.2s
 => exporting to image                                                 1.4s
 => => exporting layers                                                1.1s
 => => exporting manifest sha256:08a76aca4f446f72914df673995bbe607404  0.0s
 => => exporting config sha256:c62fd6691521d7499592831dfb1e8cff74dbf5  0.0s
 => => exporting attestation manifest sha256:a6d1e0ad57789334e6fb75d6  0.0s
 => => exporting manifest list sha256:4a0ab6035c048da9ea1f031ef639712  0.0s
 => => naming to docker.io/library/jobs.api:latest                     0.0s
 => => unpacking to docker.io/library/jobs.api:latest                  0.2s

View build details: docker-desktop://dashboard/build/desktop-linux/desktop-linux/yr00spe63t7z682pw708rlq09
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker build -t identity.api -f .\Services\Identity.Api\Dockerfile .
[+] Building 13.1s (20/20) FINISHED                    docker:desktop-linux
 => [internal] load build definition from Dockerfile                   0.0s
 => => transferring dockerfile: 722B                                   0.0s
 => [internal] load metadata for mcr.microsoft.com/dotnet/core/sdk:2.  0.1s
 => [internal] load metadata for mcr.microsoft.com/dotnet/core/aspnet  0.1s
 => [internal] load .dockerignore                                      0.0s
 => => transferring context: 2B                                        0.0s
 => [build 1/9] FROM mcr.microsoft.com/dotnet/core/sdk:2.1-stretch@sh  0.0s
 => => resolve mcr.microsoft.com/dotnet/core/sdk:2.1-stretch@sha256:a  0.0s
 => [base 1/2] FROM mcr.microsoft.com/dotnet/core/aspnet:2.1-stretch-  0.0s
 => => resolve mcr.microsoft.com/dotnet/core/aspnet:2.1-stretch-slim@  0.0s
 => [internal] load build context                                      0.0s
 => => transferring context: 9.56kB                                    0.0s
 => CACHED [build 2/9] WORKDIR /src                                    0.0s
 => [build 3/9] COPY Services/Identity.Api Services/Identity.Api/      0.1s
 => [build 4/9] COPY Foundation/Events Foundation/Events/              0.0s
 => [build 5/9] RUN ls -la                                             0.2s
 => [build 6/9] RUN dotnet restore "Services/Identity.Api/Identity.Ap  3.9s
 => [build 7/9] COPY . .                                               0.2s
 => [build 8/9] WORKDIR /src/Services/Identity.Api                     0.1s
 => [build 9/9] RUN dotnet build "Identity.Api.csproj" -c Release -o   2.2s
 => [publish 1/1] RUN dotnet publish "Identity.Api.csproj" -c Release  4.2s
 => CACHED [base 2/2] WORKDIR /app                                     0.0s
 => CACHED [final 1/2] WORKDIR /app                                    0.0s
 => [final 2/2] COPY --from=publish /app/publish .                     0.3s
 => exporting to image                                                 1.6s
 => => exporting layers                                                1.2s
 => => exporting manifest sha256:2e2cbb684b232b87e668ef296dfc16e41517  0.0s
 => => exporting config sha256:dc622bda6704289b45fcaf7598bf3899330b16  0.0s
 => => exporting attestation manifest sha256:7f611b9e228a52f8f6aeb199  0.0s
 => => exporting manifest list sha256:9cafe0ab725dabc8b32e1c816fbb687  0.0s
 => => naming to docker.io/library/identity.api:latest                 0.0s
 => => unpacking to docker.io/library/identity.api:latest              0.2s

View build details: docker-desktop://dashboard/build/desktop-linux/desktop-linux/sowa9r4im9x4a8p477gsqhg72
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker build -t mssql-linux -f .\Database\Dockerfile .\Database
[+] Building 35.1s (10/10) FINISHED                    docker:desktop-linux
 => [internal] load build definition from Dockerfile                   0.0s
 => => transferring dockerfile: 310B                                   0.0s
 => [internal] load metadata for mcr.microsoft.com/mssql/server:2017-  0.5s
 => [internal] load .dockerignore                                      0.0s
 => => transferring context: 2B                                        0.0s
 => [1/5] FROM mcr.microsoft.com/mssql/server:2017-latest@sha256:e05  31.2s
 => => resolve mcr.microsoft.com/mssql/server:2017-latest@sha256:e051  0.0s
 => => sha256:6038b4deeb58dc09a3ba444f38a6a184d2d88 69.70MB / 69.70MB  4.1s
 => => sha256:b4b37408036f381e8ebde1fb25cda2e54a 361.39MB / 361.39MB  26.4s
 => => sha256:699451820735fbbcbb93abbd25e13001df88b 27.95MB / 27.95MB  1.9s
 => => extracting sha256:699451820735fbbcbb93abbd25e13001df88b726c684  0.6s
 => => extracting sha256:b4b37408036f381e8ebde1fb25cda2e54a9ba2aa4ba2  3.6s
 => => extracting sha256:6038b4deeb58dc09a3ba444f38a6a184d2d88af4bd01  1.1s
 => [internal] load build context                                      0.1s
 => => transferring context: 12.64kB                                   0.0s
 => [2/5] COPY entrypoint.sh entrypoint.sh                             2.2s
 => [3/5] COPY SqlCmdStartup.sh SqlCmdStartup.sh                       0.1s
 => [4/5] COPY SqlCmdScript.sql SqlCmdScript.sql                       0.1s
 => [5/5] RUN chmod +x ./SqlCmdStartup.sh                              0.4s
 => exporting to image                                                 0.5s
 => => exporting layers                                                0.2s
 => => exporting manifest sha256:c45d49613c0c99cea4cbbdd1686f5f37cb8f  0.0s
 => => exporting config sha256:3a2962bd7af66aca7fc410c5436c0a57585d26  0.0s
 => => exporting attestation manifest sha256:958fa3f2ebf84e4b9a19e7fc  0.0s
 => => exporting manifest list sha256:40b704095f62c5e6c735d967c63f904  0.0s
 => => naming to docker.io/library/mssql-linux:latest                  0.0s
 => => unpacking to docker.io/library/mssql-linux:latest               0.1s

 2 warnings found (use docker --debug to expand):
 - SecretsUsedInArgOrEnv: Do not use ARG or ENV instructions for sensitive data (ENV "SA_PASSWORD") (line 2)
 - JSONArgsRecommended: JSON arguments recommended for CMD to prevent unintended behavior related to OS signals (line 8)

View build details: docker-desktop://dashboard/build/desktop-linux/desktop-linux/zbtchop7se3zl68r7j5ssfumx
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker images | Select-String "web|applicants.api|jobs.api|identity.api|mssql-linux|redis|rabbitmq"

mssql-linux
latest
   40b704095f62   13 seconds ago       1.81GB
identity.api
latest
   9cafe0ab725d   About a minute ago   428MB
jobs.api
latest
   4a0ab6035c04   About a minute ago   428MB
applicants.api
latest
   57476b15eb2c   About a minute ago   428MB
web
latest
   23d3f97e6e44   2 minutes ago        429MB
conteneuretorchestrationm2cloud-webserver
latest
   1ca6a3b240ac   8 weeks ago          175MB


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker compose up -d --build
time="2025-12-23T20:23:18+01:00" level=warning msg="C:\\Users\\Dimitri ANGELY\\Desktop\\laboratoire\\Leclerc-vincent\\tp-k8s-microservices\\src\\m2cloud\\projet_k8s\\appscore\\docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
[+] Running 19/19
 ✔ user.data Pulled                                                    6.4s
   ✔ 0c16123e68fb Pull complete                                        0.5s
   ✔ ae4ce04d0e1c Pull complete                                        4.0s
   ✔ 1d9a95b931a8 Pull complete                                        4.4s
   ✔ 4f4fb700ef54 Pull complete                                        0.0s
   ✔ 2cedcff21aff Pull complete                                        0.7s
   ✔ 60f52e32d520 Pull complete                                        0.4s
   ✔ 30e994012175 Pull complete                                        4.3s
 ✔ rabbitmq Pulled                                                     7.6s
   ✔ d686b50ce172 Pull complete                                        5.5s
   ✔ 5e1c03b67a78 Pull complete                                        0.7s
   ✔ 14e6209d5fa8 Pull complete                                        0.7s
   ✔ f4e7f62f4b80 Pull complete                                        0.7s
   ✔ 3fadc669ef11 Pull complete                                        4.6s
   ✔ efa05c660812 Pull complete                                        0.7s
   ✔ beb0d870d438 Pull complete                                        0.7s
   ✔ d63c4408fdb7 Pull complete                                        5.2s
   ✔ 20043066d3d5 Pull complete                                        4.1s
   ✔ 7084ac8f4ab6 Pull complete                                        4.7s
[+] Building 2.2s (66/66) FINISHED
 => [internal] load local bake definitions                             0.0s
 => => reading from stdin 3.27kB                                       0.0s
 => [sql_data internal] load build definition from Dockerfile          0.0s
 => => transferring dockerfile: 310B                                   0.0s
 => [jobs_api internal] load build definition from Dockerfile          0.1s
 => => transferring dockerfile: 680B                                   0.0s
 => [identity_api internal] load build definition from Dockerfile      0.1s
 => => transferring dockerfile: 722B                                   0.0s
 => [applicants_api internal] load build definition from Dockerfile    0.0s
 => => transferring dockerfile: 728B                                   0.0s
 => [webmvc internal] load build definition from Dockerfile            0.1s
 => => transferring dockerfile: 600B                                   0.0s
 => [jobs_api internal] load metadata for mcr.microsoft.com/dotnet/co  0.3s
 => [jobs_api internal] load metadata for mcr.microsoft.com/dotnet/co  0.3s
 => [sql_data internal] load metadata for mcr.microsoft.com/mssql/ser  0.2s
 => [webmvc internal] load .dockerignore                               0.0s
 => => transferring context: 2B                                        0.0s
 => [sql_data internal] load .dockerignore                             0.0s
 => => transferring context: 2B                                        0.0s
 => [identity_api build 1/8] FROM mcr.microsoft.com/dotnet/core/sdk:2  0.0s
 => => resolve mcr.microsoft.com/dotnet/core/sdk:2.1-stretch@sha256:a  0.0s
 => [applicants_api base 1/2] FROM mcr.microsoft.com/dotnet/core/aspn  0.0s
 => => resolve mcr.microsoft.com/dotnet/core/aspnet:2.1-stretch-slim@  0.0s
 => [jobs_api internal] load build context                             0.0s
 => => transferring context: 9.56kB                                    0.0s
 => [sql_data 1/5] FROM mcr.microsoft.com/mssql/server:2017-latest@sh  0.0s
 => => resolve mcr.microsoft.com/mssql/server:2017-latest@sha256:e051  0.0s
 => [sql_data internal] load build context                             0.0s
 => => transferring context: 106B                                      0.0s
 => CACHED [sql_data 2/5] COPY entrypoint.sh entrypoint.sh             0.0s
 => CACHED [sql_data 3/5] COPY SqlCmdStartup.sh SqlCmdStartup.sh       0.0s
 => CACHED [sql_data 4/5] COPY SqlCmdScript.sql SqlCmdScript.sql       0.0s
 => CACHED [sql_data 5/5] RUN chmod +x ./SqlCmdStartup.sh              0.0s
 => [sql_data] exporting to image                                      0.5s
 => => exporting layers                                                0.0s
 => => exporting manifest sha256:38eef7b012dcd4c72ceb7aee79317e7dfb90  0.1s
 => => exporting config sha256:e7e768aabf7cc02214ed9bc080a12ed24a33f2  0.1s
 => => exporting attestation manifest sha256:7d4db3483a1e138c758cf0cf  0.2s
 => => exporting manifest list sha256:e7107e02d858bc3787ae732dd1b5dfa  0.1s
 => => naming to docker.io/library/mssql-linux:latest                  0.0s
 => => unpacking to docker.io/library/mssql-linux:latest               0.0s
 => CACHED [identity_api base 2/2] WORKDIR /app                        0.0s
 => CACHED [identity_api final 1/2] WORKDIR /app                       0.0s
 => CACHED [identity_api build 2/8] WORKDIR /src                       0.0s
 => CACHED [webmvc build 3/8] COPY Web Web/                            0.0s
 => CACHED [webmvc build 4/8] COPY Foundation/Http Foundation/Http/    0.0s
 => CACHED [webmvc build 5/8] RUN dotnet restore "Web/Web.csproj"      0.0s
 => CACHED [webmvc build 6/8] COPY . .                                 0.0s
 => CACHED [webmvc build 7/8] WORKDIR /src/Web                         0.0s
 => CACHED [webmvc build 8/8] RUN dotnet build "Web.csproj" -c Releas  0.0s
 => CACHED [webmvc publish 1/1] RUN dotnet publish "Web.csproj" -c Re  0.0s
 => CACHED [webmvc final 2/2] COPY --from=publish /app/publish .       0.0s
 => CACHED [jobs_api build 3/8] COPY Services/Jobs.Api Services/Jobs.  0.0s
 => CACHED [jobs_api build 4/8] COPY Foundation/Events Foundation/Eve  0.0s
 => CACHED [jobs_api build 5/8] RUN dotnet restore "Services/Jobs.Api  0.0s
 => CACHED [jobs_api build 6/8] COPY . .                               0.0s
 => CACHED [jobs_api build 7/8] WORKDIR /src/Services/Jobs.Api         0.0s
 => CACHED [jobs_api build 8/8] RUN dotnet build "jobs.api.csproj" -c  0.0s
 => CACHED [jobs_api publish 1/1] RUN dotnet publish "jobs.api.csproj  0.0s
 => CACHED [jobs_api final 2/2] COPY --from=publish /app/publish .     0.0s
 => CACHED [applicants_api build 3/8] COPY Services/Applicants.Api Se  0.0s
 => CACHED [applicants_api build 4/8] COPY Foundation/Events Foundati  0.0s
 => CACHED [applicants_api build 5/8] RUN dotnet restore "Services/Ap  0.0s
 => CACHED [applicants_api build 6/8] COPY . .                         0.0s
 => CACHED [applicants_api build 7/8] WORKDIR /src/Services/Applicant  0.0s
 => CACHED [applicants_api build 8/8] RUN dotnet build "applicants.ap  0.0s
 => CACHED [applicants_api publish 1/1] RUN dotnet publish "applicant  0.0s
 => CACHED [applicants_api final 2/2] COPY --from=publish /app/publis  0.0s
 => CACHED [identity_api build 3/9] COPY Services/Identity.Api Servic  0.0s
 => CACHED [identity_api build 4/9] COPY Foundation/Events Foundation  0.0s
 => CACHED [identity_api build 5/9] RUN ls -la                         0.0s
 => CACHED [identity_api build 6/9] RUN dotnet restore "Services/Iden  0.0s
 => CACHED [identity_api build 7/9] COPY . .                           0.0s
 => CACHED [identity_api build 8/9] WORKDIR /src/Services/Identity.Ap  0.0s
 => CACHED [identity_api build 9/9] RUN dotnet build "Identity.Api.cs  0.0s
 => CACHED [identity_api publish 1/1] RUN dotnet publish "Identity.Ap  0.0s
 => CACHED [identity_api final 2/2] COPY --from=publish /app/publish   0.0s
 => [applicants_api] exporting to image                                0.5s
 => => exporting layers                                                0.0s
 => => exporting manifest sha256:ffd50b37769f32ca1855ba183fd1ee707797  0.1s
 => => exporting config sha256:37a9dd3b60e50b59bee79b8e1631f4272321fb  0.1s
 => => exporting attestation manifest sha256:3d3679ea6f739dfa82ad0f65  0.2s
 => => exporting manifest list sha256:81d88aa95a00cf01c82b96a3747aff9  0.1s
 => => naming to docker.io/library/applicants.api:latest               0.0s
 => => unpacking to docker.io/library/applicants.api:latest            0.0s
 => [webmvc] exporting to image                                        0.5s
 => => exporting layers                                                0.0s
 => => exporting manifest sha256:2644b3213d0c06f7f28b599f6f3e2d9cde7b  0.1s
 => => exporting config sha256:2c591c3efdf51b4afc5edf5a7db8731daa5416  0.1s
 => => exporting attestation manifest sha256:13bbed253e79c2e84a63172e  0.2s
 => => exporting manifest list sha256:f49ea0cebbbddd16266227a55a7cee2  0.1s
 => => naming to docker.io/library/web:latest                          0.0s
 => => unpacking to docker.io/library/web:latest                       0.0s
 => [jobs_api] exporting to image                                      0.5s
 => => exporting layers                                                0.0s
 => => exporting manifest sha256:9183fdb563a46658c7fd2e1f168676eafd90  0.1s
 => => exporting config sha256:5d48ef68d31b4b5672734dc205f9481cfbdc5c  0.1s
 => => exporting attestation manifest sha256:d1330b2ae5a152ae1d981377  0.2s
 => => exporting manifest list sha256:76887e2b841628680c947e1744d3a2a  0.1s
 => => naming to docker.io/library/jobs.api:latest                     0.0s
 => => unpacking to docker.io/library/jobs.api:latest                  0.0s
 => [identity_api] exporting to image                                  0.5s
 => => exporting layers                                                0.0s
 => => exporting manifest sha256:59478dc064eb42eae1bb21f6e5701dc6faaa  0.1s
 => => exporting config sha256:6a2c5da39f26c07c99ce81ae809de2bc4e5d70  0.1s
 => => exporting attestation manifest sha256:ef1662d0be8b316b9c79cc33  0.2s
 => => exporting manifest list sha256:f3eb8d3f4cc9cf1f70a7d72a15c369c  0.1s
 => => naming to docker.io/library/identity.api:latest                 0.0s
 => => unpacking to docker.io/library/identity.api:latest              0.0s
 => [sql_data] resolving provenance for metadata file                  0.2s
 => [applicants_api] resolving provenance for metadata file            0.2s
 => [webmvc] resolving provenance for metadata file                    0.1s
 => [jobs_api] resolving provenance for metadata file                  0.1s
 => [identity_api] resolving provenance for metadata file              0.0s
[+] Running 13/13
 ✔ mssql-linux                     Built                               0.0s
 ✔ jobs.api                        Built                               0.0s
 ✔ applicants.api                  Built                               0.0s
 ✔ web                             Built                               0.0s
 ✔ identity.api                    Built                               0.0s
 ✔ Network appscore_default        Creat...                            0.2s
 ✔ Container rabbitmq              Started                             1.7s
 ✔ Container appscore-user.data-1  Started                             1.8s
 ✔ Container mssql-linux           Started                             1.7s
 ✔ Container jobs.api              Started                             1.2s
 ✔ Container applicants.api        Start...                            1.1s
 ✔ Container identity.api          Started                             1.2s
 ✔ Container web                   Started                             1.4s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker ps
CONTAINER ID   IMAGE                   COMMAND                  CREATED         STATUS                                    PORTS                                                                                          NAMES
0af1a6e78eee   web                     "dotnet Web.dll"         8 seconds ago   Up 6 seconds                              0.0.0.0:8080->80/tcp, [::]:8080->80/tcp                                                        web
a3084af141f0   applicants.api          "dotnet applicants.a…"   8 seconds ago   Up 3 seconds                              0.0.0.0:8081->80/tcp, [::]:8081->80/tcp                                                        applicants.api
9e23fcc8f4a9   jobs.api                "dotnet jobs.api.dll"    8 seconds ago   Restarting (139) Less than a second ago                                                                                                  jobs.api
6e53d05d779c   mssql-linux             "/opt/mssql/bin/nonr…"   9 seconds ago   Up 7 seconds                              0.0.0.0:1433->1433/tcp, [::]:1433->1433/tcp                                                    mssql-linux
3dab73785ddc   rabbitmq:3-management   "docker-entrypoint.s…"   9 seconds ago   Up 7 seconds                              0.0.0.0:5672->5672/tcp, [::]:5672->5672/tcp, 0.0.0.0:15672->15672/tcp, [::]:15672->15672/tcp   rabbitmq
82dfe0390fb5   redis                   "docker-entrypoint.s…"   9 seconds ago   Up 7 seconds                              0.0.0.0:6379->6379/tcp, [::]:6379->6379/tcp                                                    appscore-user.data-1
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> Get-ChildItem .\src\m2cloud\projet_k8s\appscore -Recurse -File -Filter Dockerfile | Select-Object FullName
Get-ChildItem : Impossible de trouver le chemin d'accès «C:\Users\Dimitri A
NGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\
projet_k8s\appscore\src\m2cloud\projet_k8s\», car il n'existe pas.
Au caractère Ligne:1 : 1
+ Get-ChildItem .\src\m2cloud\projet_k8s\appscore -Recurse -File -Filte ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (C:\Users\Dimitr...oud\proje
   t_k8s\:String) [Get-ChildItem], ItemNotFoundException
    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.G
   etChildItemCommand

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> Get-ChildItem .\src\m2cloud\projet_k8s\appscore -Recurse -File -Filter Dockerfile | Select-Object FullName
Get-ChildItem : Impossible de trouver le chemin d'accès «C:\Users\Dimitri A
NGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\
projet_k8s\appscore\src\m2cloud\projet_k8s\», car il n'existe pas.
Au caractère Ligne:1 : 1
+ Get-ChildItem .\src\m2cloud\projet_k8s\appscore -Recurse -File -Filte ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (C:\Users\Dimitr...oud\proje
   t_k8s\:String) [Get-ChildItem], ItemNotFoundException
    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.G
   etChildItemCommand

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> pwd

Path
----
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-micro...


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> Get-ChildItem . -Recurse -File -Filter Dockerfile | Select-Object FullName

FullName
--------
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-micro...
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-micro...
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-micro...
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-micro...
C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-micro...


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker images | Select-String "web|applicants.api|jobs.api|identity.api|mssql-linux"

mssql-linux
latest
   e7107e02d858   7 minutes ago   1.81GB
identity.api
latest
   f3eb8d3f4cc9   8 minutes ago   428MB
jobs.api
latest
   76887e2b8416   8 minutes ago   428MB
applicants.api
latest
   81d88aa95a00   9 minutes ago   428MB
web
latest
   f49ea0cebbbd   9 minutes ago   429MB
conteneuretorchestrationm2cloud-webserver
latest
   1ca6a3b240ac   8 weeks ago     175MB


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> az login
Select the account you want to log in with. For more information on login with Azure CLI, see https://go.microsoft.com/fwlink/?linkid=2271136

Retrieving tenants and subscriptions for the selection...
Authentication failed against tenant 50aa635e-a60e-463c-b18b-640ccdf72975 'Default Directory': (pii). Status: Response_Status.Status_InteractionRequired, Error code: 3399614467, Tag: 558133255
If you need to access subscriptions in the following tenants, please use `az login --tenant TENANT_ID`.
50aa635e-a60e-463c-b18b-640ccdf72975 'Default Directory'
No subscriptions found for dimitri.angely@outlook.com.

[Survey] Tell us what you think of Azure CLI. This survey should take about 2 minutes. Run 'az survey' to open in browser. Learn more at https://go.microsoft.com/fwlink/?linkid=2203309

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> az login
Select the account you want to log in with. For more information on login with Azure CLI, see https://go.microsoft.com/fwlink/?linkid=2271136

Retrieving tenants and subscriptions for the selection...
Authentication failed against tenant 50aa635e-a60e-463c-b18b-640ccdf72975 'Default Directory': (pii). Status: Response_Status.Status_InteractionRequired, Error code: 3399614467, Tag: 558133255
If you need to access subscriptions in the following tenants, please use `az login --tenant TENANT_ID`.
50aa635e-a60e-463c-b18b-640ccdf72975 'Default Directory'
No subscriptions found for dimitri.angely@outlook.com.
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> az account tenant list -o table
Preview version of extension is disabled by default for extension installation, enabled for modules without stable versions.
Please run 'az config set extension.dynamic_install_allow_preview=true or false' to config it specifically.
The command requires the extension account. Do you want to install it now? The command will continue to run after the extension is installed. (Y/n): y
Run 'az config set extension.use_dynamic_install=yes_without_prompt' to allow installing extensions without prompt.
An error occurred. Pip failed with status code 3221225477. Use --debug for more information.
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> --debug
Au caractère Ligne:1 : 3
+ --debug
+   ~
Expression manquante après l’opérateur unaire « -- ».
Au caractère Ligne:1 : 3
+ --debug
+   ~~~~~
Jeton inattendu « debug » dans l’expression ou l’instruction.
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorReco
   rdException
    + FullyQualifiedErrorId : MissingExpressionAfterOperator

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> az login --tenant 50aa635e-a60e-463c-b18b-640ccdf72975
Select the account you want to log in with. For more information on login with Azure CLI, see https://go.microsoft.com/fwlink/?linkid=2271136

Retrieving subscriptions for the selection...

[Tenant and subscription selection]

No     Subscription name     Subscription ID                       Tenant
-----  --------------------  ------------------------------------  ------------------------------------
[1] *  Azure subscription 1  2ee79c4f-a53a-4bc4-9547-d92d559bde71  50aa635e-a60e-463c-b18b-640ccdf72975

The default is marked with an *; the default tenant is '50aa635e-a60e-463c-b18b-640ccdf72975' and subscription is 'Azure subscription 1' (2ee79c4f-a53a-4bc4-9547-d92d559bde71).

Select a subscription and tenant (Type a number or Enter for no changes): 1

Tenant: 50aa635e-a60e-463c-b18b-640ccdf72975
Subscription: Azure subscription 1 (2ee79c4f-a53a-4bc4-9547-d92d559bde71)

[Announcements]
With the new Azure CLI login experience, you can select the subscription you want to use more easily. Learn more about it and its configuration at https://go.microsoft.com/fwlink/?linkid=2271236

If you encounter any problem, please open an issue at https://aka.ms/azclibug

[Warning] The login output has been updated. Please be aware that it no longer displays the full list of available subscriptions by default.

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> az acr list -o table
NAME            RESOURCE GROUP                    LOCATION       SKU       LOGIN SERVER                                CREATION DATE         ADMIN ENABLED
--------------  --------------------------------  -------------  --------  ------------------------------------------  --------------------  ---------------
tpfinal         tp-final-conteneur-orchestration  francecentral  Standard  tpfinal.azurecr.io                          2025-12-23T21:18:08Z  False
PS C:\Users\Dimitri ANGELY\Desktop\labora$ACR="tpfinal"vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore>
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> $LOGIN_SERVER="$ACR.azurecr.io"
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> $VERSION="1.0.0"
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> az acr login --name $ACR
The output will be changed in next breaking change release(2.73.0) scheduled for May 2025. Exit code will be 1 if command fails for docker login.
Login Succeeded
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker images | Select-String "web|applicants.api|jobs.api|identity.api|mssql-linux"
WARNING: This output is designed for human readability. For machine-readable output, please use --format.

applicants.api:latest                                                                                   81d88aa95a00        428MB          120MB   U
conteneuretorchestrationm2cloud-webserver:latest                                                        1ca6a3b240ac        175MB         45.2MB
identity.api:latest                                                                                     f3eb8d3f4cc9        428MB          120MB   U
jobs.api:latest                                                                                         76887e2b8416        428MB          120MB   U
mssql-linux:latest                                                                                      e7107e02d858       1.81GB          459MB   U
web:latest                                                                                              f49ea0cebbbd        429MB          120MB   U


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker tag web "$LOGIN_SERVER/webmvc:$VERSION"
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker tag applicants.api "$LOGIN_SERVER/applicants-api:$VERSION"
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker tag jobs.api "$LOGIN_SERVER/jobs-api:$VERSION"
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker tag identity.api "$LOGIN_SERVER/identity-api:$VERSION"
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker tag mssql-linux "$LOGIN_SERVER/sql-data:$VERSION"
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker push "$LOGIN_SERVER/webmvc:$VERSION"
The push refers to repository [tpfinal.azurecr.io/webmvc]
4f4fb700ef54: Pushed
06e05c6a34c1: Pushed
33f99cea3b7d: Pushed
2b463c1ef5a9: Pushed
006142832367: Pushed
f1ee1a1d9f31: Pushed
27b9514a671f: Pushed
f66af433fc3e: Pushed
1.0.0: digest: sha256:f49ea0cebbbddd16266227a55a7cee2eee24c598ee77b34dd39a2133a35f3489 size: 856
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker push "$LOGIN_SERVER/applicants-api:$VERSION"
The push refers to repository [tpfinal.azurecr.io/applicants-api]
4f4fb700ef54: Mounted from webmvc
27b9514a671f: Mounted from webmvc
33f99cea3b7d: Mounted from webmvc
06e05c6a34c1: Mounted from webmvc
2b463c1ef5a9: Mounted from webmvc
4c157858edf6: Pushed
2cd2a9724a83: Pushed
f66af433fc3e: Mounted from webmvc
1.0.0: digest: sha256:81d88aa95a00cf01c82b96a3747aff962216cb50a8a1c962d7b078c47f4a5e4a size: 856
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker push "$LOGIN_SERVER/jobs-api:$VERSION"
The push refers to repository [tpfinal.azurecr.io/jobs-api]
06e05c6a34c1: Mounted from webmvc
4133cd2b3b7a: Pushed
d20840fe41d2: Pushed
f66af433fc3e: Mounted from webmvc
27b9514a671f: Mounted from webmvc
33f99cea3b7d: Mounted from webmvc
2b463c1ef5a9: Mounted from webmvc
4f4fb700ef54: Mounted from webmvc
1.0.0: digest: sha256:76887e2b841628680c947e1744d3a2ad03cdfc03b77301a2c5615e8cb3dd1e71 size: 856
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker push "$LOGIN_SERVER/identity-api:$VERSION"
The push refers to repository [tpfinal.azurecr.io/identity-api]
4f4fb700ef54: Mounted from webmvc
781716ce85bd: Pushed
df5c67f875c1: Pushed
f66af433fc3e: Mounted from webmvc
27b9514a671f: Mounted from webmvc
33f99cea3b7d: Mounted from webmvc
2b463c1ef5a9: Mounted from webmvc
06e05c6a34c1: Mounted from webmvc
1.0.0: digest: sha256:f3eb8d3f4cc9cf1f70a7d72a15c369c5f00c81a76f424fce24dac9cdfcb09d11 size: 856
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> docker push "$LOGIN_SERVER/sql-data:$VERSION"
The push refers to repository [tpfinal.azurecr.io/sql-data]
2ba40f18690c: Pushed
5ac3ad2a9a5c: Pushed
b4b37408036f: Pushed
c64583bdd0dc: Pushed
212ad141705d: Pushed
4f4fb700ef54: Mounted from webmvc
699451820735: Pushed
6038b4deeb58: Pushed
1.0.0: digest: sha256:e7107e02d858bc3787ae732dd1b5dfa139144b7fb6281ef9e780a4011ecd7029 size: 856
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> az acr repository list --name $ACR -o table
Result
--------------
applicants-api
identity-api
jobs-api
sql-data
webmvc
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> az acr repository show-tags --name $ACR --repository webmvc -o table
Result
--------
1.0.0
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> az acr list -o table
NAME            RESOURCE GROUP                    LOCATION       SKU       LOGIN SERVER                                CREATION DATE         ADMIN ENABLED
--------------  --------------------------------  -------------  --------  ------------------------------------------  --------------------  ---------------
tpfinal         tp-final-conteneur-orchestration  francecentral  Standard  tpfinal.azurecr.io                          2025-12-23T21:18:08Z  False
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> cd tp-k8s-microservices
cd : Impossible de trouver le chemin d'accès «C:\Users\Dimitri
ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore\tp-k8s-microservices», car il n'existe pas.
Au caractère Ligne:1 : 1
+ cd tp-k8s-microservices
+ ~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (C:\Users\Dimitr...s-microservices:String) [Set-Location], ItemNotFoundException
    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.SetLocationCommand

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s\appscore> cd..
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud\projet_k8s> cd..
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src\m2cloud> cd..
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\src> cd..
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> @"
>> ACR_NAME=tpfinal
>> ACR_LOGIN_SERVER=tpfinal.azurecr.io
>> IMAGES_VERSION=1.0.0
>> "@ | Set-Content -Encoding UTF8 .\02-images\registry.env
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .\02-images\registry.env
warning: in the working copy of '02-images/registry.env', LF will be replaced by CRLF the next time Git touches it
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git commit -m "sauvegarde des variables du registre de conteneur azure"

[main 34db53d] sauvegarde des variables du registre de conteneur azure
 1 file changed, 3 insertions(+)
 create mode 100644 02-images/registry.env
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl version --client
Client Version: v1.34.1
Kustomize Version: v5.7.1
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl get nodes
NAME             STATUS   ROLES           AGE   VERSION
docker-desktop   Ready    control-plane   77d   v1.34.1
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl create namespace tp-prod
namespace/tp-prod created
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl get ns | Select-String "tp-prod"

tp-prod            Active   9s


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl label namespace tp-prod project=tp-k8s env=prod --overwrite
namespace/tp-prod labeled
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl get namespace tp-prod --show-labels
NAME      STATUS   AGE   LABELS
tp-prod   Active   31s   env=prod,kubernetes.io/metadata.name=tp-prod,project=tp-k8s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod create secret generic sql-secrets `
>>   --from-literal=SA_PASSWORD='Pass@word'
secret/sql-secrets created
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get secret sql-secrets
NAME          TYPE     DATA   AGE
sql-secrets   Opaque   1      7s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> @"
>> apiVersion: v1
>> kind: Namespace
>> metadata:
>>   name: tp-prod
>>   labels:
>>     project: tp-k8s
>>     env: prod
>> "@ | Set-Content -Encoding UTF8 .\03-k8s-manifests\base\namespace.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> @"
>> apiVersion: v1
>> kind: Secret
>> metadata:
>>   name: sql-secrets
>>   namespace: tp-prod
>> type: Opaque
>> stringData:
>>   SA_PASSWORD: "Pass@word"
>> "@ | Set-Content -Encoding UTF8 .\03-k8s-manifests\base\sql-secret.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .\03-k8s-manifests\base\namespace.yaml
warning: in the working copy of '03-k8s-manifests/base/namespace.yaml', LF will be replaced by CRLF the next time Git touches it
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .\03-k8s-manifests\base\sql-secret.yaml
warning: in the working copy of '03-k8s-manifests/base/sql-secret.yaml', LF will be replaced by CRLF the next time Git touches it
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git commit -m "(k8s): ajout du namespace et secret de base sql"
[main 314f2b7] (k8s): ajout du namespace et secret de base sql
 2 files changed, 15 insertions(+)
 create mode 100644 03-k8s-manifests/base/namespace.yaml
 create mode 100644 03-k8s-manifests/base/sql-secret.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl get nodes
NAME             STATUS   ROLES           AGE   VERSION
docker-desktop   Ready    control-plane   77d   v1.34.1
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get secret
NAME          TYPE     DATA   AGE
sql-secrets   Opaque   1      4m46s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices>















                                                                                     cd C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\03-k8s-manifests\infra
Set-Location : Impossible de trouver un paramètre positionnel acceptant l'argument «
ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\03-k8s-manifests\infra».
Au caractère Ligne:1 : 1
+ cd C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidArgument : (:) [Set-Location], ParameterBindingException
    + FullyQualifiedErrorId : PositionalParameterNotFound,Microsoft.PowerShell.Commands.SetLocationCommand

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> ls


    Répertoire : C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:56                01-compose-analysis
d-----        24/12/2025     10:27                02-images
d-----        23/12/2025     19:35                03-k8s-manifests
d-----        23/12/2025     19:35                04-helm-chart
d-----        23/12/2025     19:35                05-tests
d-----        23/12/2025     19:35                docs
d-----        23/12/2025     19:49                src
-a----        23/12/2025     19:53            360 .gitignore
-a----        23/12/2025     19:52            502 README.md


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> cd .\03-k8s-manifests\
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\03-k8s-manifests> ls


    Répertoire : C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\03-k8s-manifests


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        23/12/2025     19:35                apps
d-----        24/12/2025     10:33                base
d-----        23/12/2025     19:35                infra
d-----        23/12/2025     19:35                logging
d-----        23/12/2025     19:35                observability
d-----        23/12/2025     19:35                security
-a----        23/12/2025     19:35              0 README.md


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\03-k8s-manifests> cd .\infra\
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\03-k8s-manifests\infra> cd..
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\03-k8s-manifests> cd..
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> @"
>> apiVersion: apps/v1
>> kind: Deployment
>> metadata:
>>   name: user-data
>>   namespace: tp-prod
>>   labels:
>>     app: user-data
>> spec:
>>   replicas: 1
>>   selector:
>>     matchLabels:
>>       app: user-data
>>   template:
>>     metadata:
>>       labels:
>>         app: user-data
>>     spec:
>>       containers:
>>         - name: redis
>>           image: redis:7
>>           ports:
>>             - containerPort: 6379
>>           resources:
>>             requests:
>>               cpu: "4m"
>>               memory: "500Mi"
>>             limits:
>>               cpu: "250m"
>>               memory: "800Mi"
>>           livenessProbe:
>>             tcpSocket:
>>               port: 6379
>>             initialDelaySeconds: 15
>>             periodSeconds: 10
>>           readinessProbe:
>>             tcpSocket:
>>               port: 6379
>>             initialDelaySeconds: 5
>>             periodSeconds: 5
>> ---
>> apiVersion: v1
>> kind: Service
>> metadata:
>>   name: user-data
>>   namespace: tp-prod
>>   labels:
>>     app: user-data
>> spec:
>>   type: ClusterIP
>>   selector:
>>     app: user-data
>>   ports:
>>     - name: redis
>>       port: 6379
>>       targetPort: 6379
>> "@ | Set-Content -Encoding UTF8 .\03-k8s-manifests\infra\redis-user-data.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl apply -f .\03-k8s-manifests\infra\redis-user-data.yaml
deployment.apps/user-data created
service/user-data created
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get pods -l app=user-data
NAME                         READY   STATUS    RESTARTS   AGE
user-data-7b6897b6c7-jf8bm   1/1     Running   0          12s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get svc user-data
NAME        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
user-data   ClusterIP   10.99.200.185   <none>        6379/TCP   23s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> @"
>> apiVersion: apps/v1
>> kind: Deployment
>> metadata:
>>   name: rabbitmq
>>   namespace: tp-prod
>>   labels:
>>     app: rabbitmq
>> spec:
>>   replicas: 1
>>   selector:
>>     matchLabels:
>>       app: rabbitmq
>>   template:
>>     metadata:
>>       labels:
>>         app: rabbitmq
>>     spec:
>>       containers:
>>         - name: rabbitmq
>>           image: rabbitmq:3-management
>>           ports:
>>             - name: amqp
>>               containerPort: 5672
>>             - name: mgmt
>>               containerPort: 15672
>>           resources:
>>             requests:
>>               cpu: "50m"
>>               memory: "256Mi"
>>             limits:
>>               cpu: "500m"
>>               memory: "768Mi"
>>           livenessProbe:
>>             tcpSocket:
>>               port: 5672
>>             initialDelaySeconds: 20
>>             periodSeconds: 10
>>           readinessProbe:
>>             tcpSocket:
>>               port: 5672
>>             initialDelaySeconds: 10
>>             periodSeconds: 5
>> ---
>> apiVersion: v1
>> kind: Service
>> metadata:
>>   name: rabbitmq
>>   namespace: tp-prod
>>   labels:
>>     app: rabbitmq
>> spec:
>>   type: ClusterIP
>>   selector:
>>     app: rabbitmq
>>   ports:
>>     - name: amqp
>>       port: 5672
>>       targetPort: 5672
>>     - name: mgmt
>>       port: 15672
>>       targetPort: 15672
>> "@ | Set-Content -Encoding UTF8 .\03-k8s-manifests\infra\rabbitmq.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl apply -f .\03-k8s-manifests\infra\rabbitmq.yaml
deployment.apps/rabbitmq created
service/rabbitmq created
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get pods -l app=rabbitmq
NAME                        READY   STATUS    RESTARTS   AGE
rabbitmq-78ccfb5c7b-66q7h   0/1     Running   0          13s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get svc rabbitmq
NAME       TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)              AGE
rabbitmq   ClusterIP   10.98.200.19   <none>        5672/TCP,15672/TCP   22s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod run netcheck --image=curlimages/curl:8.5.0 -it --rm -- sh
All commands and output from this session will be recorded in container logs, including credentials and sensitive information passed through the command prompt.
If you don't see a command prompt, try pressing enter.
~ $ nslookup rabbitmq
Server:         10.96.0.10
Address:        10.96.0.10:53

** server can't find rabbitmq.cluster.local: NXDOMAIN

** server can't find rabbitmq.svc.cluster.local: NXDOMAIN

** server can't find rabbitmq.cluster.local: NXDOMAIN

Name:   rabbitmq.tp-prod.svc.cluster.local
Address: 10.98.200.19

** server can't find rabbitmq.svc.cluster.local: NXDOMAIN


~ $ nslookup user-data
Server:         10.96.0.10
Address:        10.96.0.10:53

** server can't find user-data.svc.cluster.local: NXDOMAIN


** server can't find user-data.cluster.local: NXDOMAIN

** server can't find user-data.cluster.local: NXDOMAIN

Name:   user-data.tp-prod.svc.cluster.local
Address: 10.99.200.185

** server can't find user-data.svc.cluster.local: NXDOMAIN

~ $ nc -zv rabbitmq 5672
rabbitmq (10.98.200.19:5672) open
~ $ nc -zv user-data 6379
user-data (10.99.200.185:6379) open
~ $ exit
Session ended, resume using 'kubectl attach netcheck -c netcheck -i -t' command when the pod is running
pod "netcheck" deleted from tp-prod namespace
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .\03-k8s-manifests\infra\redis-user-data.yaml
warning: in the working copy of '03-k8s-manifests/infra/redis-user-data.yaml', LF will be replaced by CRLF the next time Git touches it
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .\03-k8s-manifests\infra\rabbitmq.yaml
warning: in the working copy of '03-k8s-manifests/infra/rabbitmq.yaml', LF will be replaced by CRLF the next time Git touches it
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git commit -m "(k8s): ajout des services interne rabbitmq et redis (user.data)"
[main e76a053] (k8s): ajout des services interne rabbitmq et redis (user.data)
 2 files changed, 116 insertions(+)
 create mode 100644 03-k8s-manifests/infra/rabbitmq.yaml
 create mode 100644 03-k8s-manifests/infra/redis-user-data.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get pods -o wide
NAME                         READY   STATUS    RESTARTS   AGE     IP           NODE             NOMINATED NODE   READINESS GATES
rabbitmq-78ccfb5c7b-66q7h    1/1     Running   0          4m51s   10.1.0.104   docker-desktop   <none>           <none>
user-data-7b6897b6c7-jf8bm   1/1     Running   0          9m49s   10.1.0.103   docker-desktop   <none>           <none>
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get svc
NAME        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)              AGE
rabbitmq    ClusterIP   10.98.200.19    <none>        5672/TCP,15672/TCP   5m11s
user-data   ClusterIP   10.99.200.185   <none>        6379/TCP             10m
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> @"
>> apiVersion: v1
>> kind: PersistentVolumeClaim
>> metadata:
>>   name: sql-data-pvc
>>   namespace: tp-prod
>>   labels:
>>     app: sql-data
>> spec:
>>   accessModes:
>>     - ReadWriteOnce
>>   resources:
>>     requests:
>>       storage: 5Gi
>> ---
>> apiVersion: v1
>> kind: Service
>> metadata:
>>   name: sql-data
>>   namespace: tp-prod
>>   labels:
>>     app: sql-data
>> spec:
>>   type: ClusterIP
>>   selector:
>>     app: sql-data
>>   ports:
>>     - name: mssql
>>       port: 1433
>>       targetPort: 1433
>> ---
>> apiVersion: apps/v1
>> kind: StatefulSet
>> metadata:
>>   name: sql-data
>>   namespace: tp-prod
>>   labels:
>>     app: sql-data
>> spec:
>>   serviceName: sql-data
>>   replicas: 1
>>   selector:
>>     matchLabels:
>>       app: sql-data
>>   template:
>>     metadata:
>>       labels:
>>         app: sql-data
>>     spec:
>>       containers:
>>         - name: mssql
>>           image: tpfinal.azurecr.io/sql-data:1.0.0
>>           imagePullPolicy: IfNotPresent
>>           ports:
>>             - containerPort: 1433
>>               name: mssql
>>           env:
>>             - name: ACCEPT_EULA
>>               value: "Y"
>>             - name: SA_PASSWORD
>>               valueFrom:
>>                 secretKeyRef:
>>                   name: sql-secrets
>>                   key: SA_PASSWORD
>>           volumeMounts:
>>             - name: sql-data
>>               mountPath: /var/opt/mssql
>>           resources:
>>             requests:
>>               cpu: "4m"
>>               memory: "500Mi"
>>             limits:
>>               cpu: "1"
>>               memory: "2000Mi"
>>           livenessProbe:
>>             tcpSocket:
>>               port: 1433
>>             initialDelaySeconds: 40
>>             periodSeconds: 10
>>           readinessProbe:
>>             tcpSocket:
>>               port: 1433
>>             initialDelaySeconds: 20
>>             periodSeconds: 5
>>       volumes:
>>         - name: sql-data
>>           persistentVolumeClaim:
>>             claimName: sql-data-pvc
>> "@ | Set-Content -Encoding UTF8 .\03-k8s-manifests\infra\mssql-sql-data.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl apply -f .\03-k8s-manifests\infra\mssql-sql-data.yaml
persistentvolumeclaim/sql-data-pvc created
service/sql-data created
statefulset.apps/sql-data created
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get pvc
NAME           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
sql-data-pvc   Bound    pvc-d7810ed0-1ca0-4a85-a657-62c3f70b25ec   5Gi        RWO            hostpath       <unset>                 12s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get pods -l app=sql-data
NAME         READY   STATUS    RESTARTS   AGE
sql-data-0   0/1     Running   0          12s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get svc sql-data
NAME       TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
sql-data   ClusterIP   10.110.116.207   <none>        1433/TCP   12s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod run netcheck2 --image=busybox:1.36 -it --rm -- sh
All commands and output from this session will be recorded in container logs, including credentials and sensitive information passed through the command prompt.
If you don't see a command prompt, try pressing enter.
/ #
/ #
/ # nslookup sql-data
Server:         10.96.0.10
Address:        10.96.0.10:53

** server can't find sql-data.svc.cluster.local: NXDOMAIN

Name:   sql-data.tp-prod.svc.cluster.local
Address: 10.110.116.207

** server can't find sql-data.cluster.local: NXDOMAIN


** server can't find sql-data.cluster.local: NXDOMAIN

** server can't find sql-data.svc.cluster.local: NXDOMAIN

/ # nc -zv sql-data 1433
sql-data (10.110.116.207:1433) open
/ # exit
Session ended, resume using 'kubectl attach netcheck2 -c netcheck2 -i -t' command when the pod is running
pod "netcheck2" deleted from tp-prod namespace
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .\03-k8s-manifests\infra\mssql-sql-data.yaml
warning: in the working copy of '03-k8s-manifests/infra/mssql-sql-data.yaml', LF will be replaced by CRLF the next time Git touches it
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git commit -m "(k8s): ajout de sql.data mssql statefulset avec pvc et secret"
[main c4b5c7e] (k8s): ajout de sql.data mssql statefulset avec pvc et secret
 1 file changed, 87 insertions(+)
 create mode 100644 03-k8s-manifests/infra/mssql-sql-data.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get pods -o wide
NAME                         READY   STATUS    RESTARTS   AGE     IP           NODE             NOMINATED NODE   READINESS GATES
rabbitmq-78ccfb5c7b-66q7h    1/1     Running   0          12m     10.1.0.104   docker-desktop   <none>           <none>
sql-data-0                   1/1     Running   0          4m36s   10.1.0.106   docker-desktop   <none>           <none>
user-data-7b6897b6c7-jf8bm   1/1     Running   0          17m     10.1.0.103   docker-desktop   <none>           <none>
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get pvc
NAME           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
sql-data-pvc   Bound    pvc-d7810ed0-1ca0-4a85-a657-62c3f70b25ec   5Gi        RWO            hostpath       <unset>                 4m50s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod logs -l app=sql-data --tail=40
2025-12-24 10:02:08.71 spid12s     The tempdb database has 1 data file(s).
2025-12-24 10:02:08.73 spid24s     The Service Broker endpoint is in disabled or stopped state.
2025-12-24 10:02:08.73 spid24s     The Database Mirroring endpoint is in disabled or stopped state.
2025-12-24 10:02:08.74 spid24s     Service Broker manager has started.
2025-12-24 10:02:08.99 spid51      Starting up database 'dotnetgigs.applicants'.
2025-12-24 10:02:09.03 spid51      Parallel redo is started for database 'dotnetgigs.applicants' with worker pool size [10].
2025-12-24 10:02:09.05 spid51      Parallel redo is shutdown for database 'dotnetgigs.applicants' with worker pool size [10].
Changed database context to 'master'.
2025-12-24 10:02:09.11 spid7s      Recovery is complete. This is an informational message only. No user action is required.
2025-12-24 10:02:09Changed database context to 'dotnetgigs.applicants'.
.11 spid18s     The default language (LCID 0) has been set for engine and full-text services.
2025-12-24 10:02:09.26 spid51      Starting up database 'dotnetgigs.jobs'.
2025-12-24 10:02:09.34 spid51      Parallel redo is started for database 'dotnetgigs.jobs' with worker pool size [10].
2025-12-24 10:02:09.36 spid51      Parallel redo is shutdown for database 'dotnetgigs.jobs' with worker pool size [10].

(10 rows affected)

(10 rows affected)
Changed database context to 'dotnetgigs.jobs'.

(1 rows affected)

(1 rows affected)

(1 rows affected)

(1 rows affected)

(1 rows affected)

(1 rows affected)

(1 rows affected)

(1 rows affected)

(1 rows affected)

(1 rows affected)
2025-12-24 10:06:51.11 spid51      Using 'dbghelp.dll' version '4.0.5'
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> @"
>> apiVersion: apps/v1
>> kind: Deployment
>> metadata:
>>   name: applicants-api
>>   namespace: tp-prod
>>   labels:
>>     app: applicants-api
>> spec:
>>   replicas: 2
>>   selector:
>>     matchLabels:
>>       app: applicants-api
>>   template:
>>     metadata:
>>       labels:
>>         app: applicants-api
>>     spec:
>>       containers:
>>         - name: applicants-api
>>           image: tpfinal.azurecr.io/applicants-api:1.0.0
>>           imagePullPolicy: IfNotPresent
>>           ports:
>>             - containerPort: 80
>>               name: http
>>           env:
>>             - name: ConnectionString
>>               value: "Server=sql-data;User=sa;Password=Pass@word;Database=dotnetgigs.applicants;"
>>             - name: HostRabbitmq
>>               value: "rabbitmq"
>>           resources:
>>             requests:
>>               cpu: "500m"
>>               memory: "500Mi"
>>             limits:
>>               cpu: "1"
>>               memory: "1500Mi"
>>           readinessProbe:
>>             tcpSocket:
>>               port: 80
>>             initialDelaySeconds: 10
>>             periodSeconds: 5
>>           livenessProbe:
>>             tcpSocket:
>>               port: 80
>>             initialDelaySeconds: 20
>>             periodSeconds: 10
>> ---
>> apiVersion: v1
>> kind: Service
>> metadata:
>>   name: applicants-api
>>   namespace: tp-prod
>>   labels:
>>     app: applicants-api
>> spec:
>>   type: ClusterIP
>>   selector:
>>     app: applicants-api
>>   ports:
>>     - name: http
>>       port: 80
>>       targetPort: 80
>> "@ | Set-Content -Encoding UTF8 .\03-k8s-manifests\apps\applicants-api.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl apply -f .\03-k8s-manifests\apps\applicants-api.yaml
deployment.apps/applicants-api created
service/applicants-api created
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get pods -l app=applicants-api
NAME                              READY   STATUS    RESTARTS   AGE
applicants-api-698c5b59df-lkv6s   1/1     Running   0          23s
applicants-api-698c5b59df-sk9n4   1/1     Running   0          22s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get svc applicants-api
NAME             TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
applicants-api   ClusterIP   10.100.5.242   <none>        80/TCP    23s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> @"
>> apiVersion: apps/v1
>> kind: Deployment
>> metadata:
>>   name: jobs-api
>>   namespace: tp-prod
>>   labels:
>>     app: jobs-api
>> spec:
>>   replicas: 2
>>   selector:
>>     matchLabels:
>>       app: jobs-api
>>   template:
>>     metadata:
>>       labels:
>>         app: jobs-api
>>     spec:
>>       containers:
>>         - name: jobs-api
>>           image: tpfinal.azurecr.io/jobs-api:1.0.0
>>           imagePullPolicy: IfNotPresent
>>           ports:
>>             - containerPort: 80
>>               name: http
>>           env:
>>             - name: ConnectionString
>>               value: "Server=sql-data;User=sa;Password=Pass@word;Database=dotnetgigs.jobs;"
>>             - name: HostRabbitmq
>>               value: "rabbitmq"
>>           resources:
>>             requests:
>>               cpu: "500m"
>>               memory: "500Mi"
>>             limits:
>>               cpu: "1"
>>               memory: "1500Mi"
>>           readinessProbe:
>>             tcpSocket:
>>               port: 80
>>             initialDelaySeconds: 10
>>             periodSeconds: 5
>>           livenessProbe:
>>             tcpSocket:
>>               port: 80
>>             initialDelaySeconds: 20
>>             periodSeconds: 10
>> ---
>> apiVersion: v1
>> kind: Service
>> metadata:
>>   name: jobs-api
>>   namespace: tp-prod
>>   labels:
>>     app: jobs-api
>> spec:
>>   type: ClusterIP
>>   selector:
>>     app: jobs-api
>>   ports:
>>     - name: http
>>       port: 80
>>       targetPort: 80
>> "@ | Set-Content -Encoding UTF8 .\03-k8s-manifests\apps\jobs-api.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl apply -f .\03-k8s-manifests\apps\jobs-api.yaml
deployment.apps/jobs-api created
service/jobs-api created
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get pods -l app=jobs-api
NAME                       READY   STATUS              RESTARTS   AGE
jobs-api-575578675-bz6v6   0/1     ContainerCreating   0          0s
jobs-api-575578675-lwbwp   0/1     ContainerCreating   0          0s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get svc jobs-api
NAME       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
jobs-api   ClusterIP   10.110.39.160   <none>        80/TCP    0s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> @"
>> apiVersion: apps/v1
>> kind: Deployment
>> metadata:
>>   name: identity-api
>>   namespace: tp-prod
>>   labels:
>>     app: identity-api
>> spec:
>>   replicas: 2
>>   selector:
>>     matchLabels:
>>       app: identity-api
>>   template:
>>     metadata:
>>       labels:
>>         app: identity-api
>>     spec:
>>       containers:
>>         - name: identity-api
>>           image: tpfinal.azurecr.io/identity-api:1.0.0
>>           imagePullPolicy: IfNotPresent
>>           ports:
>>             - containerPort: 80
>>               name: http
>>           env:
>>             - name: RedisHost
>>               value: "user-data:6379"
>>             - name: HostRabbitmq
>>               value: "rabbitmq"
>>           resources:
>>             requests:
>>               cpu: "500m"
>>               memory: "500Mi"
>>             limits:
>>               cpu: "1"
>>               memory: "1500Mi"
>>           readinessProbe:
>>             tcpSocket:
>>               port: 80
>>             initialDelaySeconds: 10
>>             periodSeconds: 5
>>           livenessProbe:
>>             tcpSocket:
>>               port: 80
>>             initialDelaySeconds: 20
>>             periodSeconds: 10
>> ---
>> apiVersion: v1
>> kind: Service
>> metadata:
>>   name: identity-api
>>   namespace: tp-prod
>>   labels:
>>     app: identity-api
>> spec:
>>   type: ClusterIP
>>   selector:
>>     app: identity-api
>>   ports:
>>     - name: http
>>       port: 80
>>       targetPort: 80
>> "@ | Set-Content -Encoding UTF8 .\03-k8s-manifests\apps\identity-api.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl apply -f .\03-k8s-manifests\apps\identity-api.yaml
deployment.apps/identity-api created
service/identity-api created
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get pods -l app=identity-api
NAME                            READY   STATUS              RESTARTS   AGE
identity-api-7bbc6f6cb8-ccr6w   0/1     ContainerCreating   0          1s
identity-api-7bbc6f6cb8-sx8jq   0/1     ContainerCreating   0          1s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get svc identity-api
NAME           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
identity-api   ClusterIP   10.99.169.115   <none>        80/TCP    1s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod run curltest --image=curlimages/curl:8.5.0 -it --rm -- sh
All commands and output from this session will be recorded in container logs, including credentials and sensitive information passed through the command prompt.
If you don't see a command prompt, try pressing enter.
~ $ curl -i http://applicants-api/
HTTP/1.1 404 Not Found
Date: Wed, 24 Dec 2025 10:11:31 GMT
Server: Kestrel
Content-Length: 0

~ $ curl -i http://jobs-api/
HTTP/1.1 404 Not Found
Date: Wed, 24 Dec 2025 10:11:45 GMT
Server: Kestrel
Content-Length: 0

~ $ curl -i http://identity-api/
HTTP/1.1 404 Not Found
Date: Wed, 24 Dec 2025 10:12:11 GMT
Server: Kestrel
Content-Length: 0

~ $ exit
Session ended, resume using 'kubectl attach curltest -c curltest -i -t' command when the pod is running
pod "curltest" deleted from tp-prod namespace
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .\03-k8s-manifests\apps\applicants-api.yaml
warning: in the working copy of '03-k8s-manifests/apps/applicants-api.yaml', LF will be replaced by CRLF the next time Git touches it
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .\03-k8s-manifests\apps\jobs-api.yaml
warning: in the working copy of '03-k8s-manifests/apps/jobs-api.yaml', LF will be replaced by CRLF the next time Git touches it
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .\03-k8s-manifests\apps\identity-api.yaml
warning: in the working copy of '03-k8s-manifests/apps/identity-api.yaml', LF will be replaced by CRLF the next time Git touches it
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git commit -m "(k8s): deployment des APIs comme services interne avec les ressources et les probes"
[main e5eb7d8] (k8s): deployment des APIs comme services interne avec les ressources et les probes
 3 files changed, 186 insertions(+)
 create mode 100644 03-k8s-manifests/apps/applicants-api.yaml
 create mode 100644 03-k8s-manifests/apps/identity-api.yaml
 create mode 100644 03-k8s-manifests/apps/jobs-api.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get pods
NAME                              READY   STATUS    RESTARTS   AGE
applicants-api-698c5b59df-lkv6s   1/1     Running   0          5m36s
applicants-api-698c5b59df-sk9n4   1/1     Running   0          5m35s
identity-api-7bbc6f6cb8-ccr6w     1/1     Running   0          3m50s
identity-api-7bbc6f6cb8-sx8jq     1/1     Running   0          3m50s
jobs-api-575578675-bz6v6          1/1     Running   0          4m16s
jobs-api-575578675-lwbwp          1/1     Running   0          4m16s
rabbitmq-78ccfb5c7b-66q7h         1/1     Running   0          20m
sql-data-0                        1/1     Running   0          12m
user-data-7b6897b6c7-jf8bm        1/1     Running   0          25m
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get svc
NAME             TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)              AGE
applicants-api   ClusterIP   10.100.5.242     <none>        80/TCP               5m36s
identity-api     ClusterIP   10.99.169.115    <none>        80/TCP               3m50s
jobs-api         ClusterIP   10.110.39.160    <none>        80/TCP               4m16s
rabbitmq         ClusterIP   10.98.200.19     <none>        5672/TCP,15672/TCP   20m
sql-data         ClusterIP   10.110.116.207   <none>        1433/TCP             12m
user-data        ClusterIP   10.99.200.185    <none>        6379/TCP             25m
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> @"
>> apiVersion: apps/v1
>> kind: Deployment
>> metadata:
>>   name: webmvc
>>   namespace: tp-prod
>>   labels:
>>     app: webmvc
>> spec:
>>   replicas: 2
>>   selector:
>>     matchLabels:
>>       app: webmvc
>>   template:
>>     metadata:
>>       labels:
>>         app: webmvc
>>     spec:
>>       containers:
>>         - name: webmvc
>>           image: tpfinal.azurecr.io/webmvc:1.0.0
>>           imagePullPolicy: IfNotPresent
>>           ports:
>>             - containerPort: 80
>>               name: http
>>           resources:
>>             requests:
>>               cpu: "4m"
>>               memory: "900Mi"
>>             limits:
>>               cpu: "1"
>>               memory: "2000Mi"
>>           readinessProbe:
>>             tcpSocket:
>>               port: 80
>>             initialDelaySeconds: 10
>>             periodSeconds: 5
>>           livenessProbe:
>>             tcpSocket:
>>               port: 80
>>             initialDelaySeconds: 20
>>             periodSeconds: 10
>> ---
>> apiVersion: v1
>> kind: Service
>> metadata:
>>   name: webmvc
>>   namespace: tp-prod
>>   labels:
>>     app: webmvc
>> spec:
>>   type: ClusterIP
>>   selector:
>>     app: webmvc
>>   ports:
>>     - name: http
>>       port: 80
>>       targetPort: 80
>> "@ | Set-Content -Encoding UTF8 .\03-k8s-manifests\apps\webmvc.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl apply -f .\03-k8s-manifests\apps\webmvc.yaml
deployment.apps/webmvc created
service/webmvc created
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get pods -l app=webmvc
NAME                      READY   STATUS    RESTARTS   AGE
webmvc-757695d44d-lrfd7   1/1     Running   0          22s
webmvc-757695d44d-pkrdr   1/1     Running   0          22s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get svc webmvc
NAME     TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
webmvc   ClusterIP   10.96.199.96   <none>        80/TCP    23s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod port-forward svc/webmvc 8080:80
Forwarding from 127.0.0.1:8080 -> 80
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod patch deployment webmvc --type='merge' -p '{
>>   "spec": {
>>     "template": {
>>       "spec": {
>>         "affinity": {
>>           "podAffinity": {
>>             "preferredDuringSchedulingIgnoredDuringExecution": [
>>               {
>>                 "weight": 80,
>>                 "podAffinityTerm": {
>>                   "labelSelector": { "matchLabels": { "app": "jobs-api" } },
>>                   "topologyKey": "kubernetes.io/hostname"
>>                 }
>>               },
>>               {
>>                 "weight": 80,
>>                 "podAffinityTerm": {
>>                   "labelSelector": { "matchLabels": { "app": "applicants-api" } },
>>                   "topologyKey": "kubernetes.io/hostname"
>>                 }
>>               }
>>             ]
>>           }
>>         }
>>       }
>>     }
>>   }
>> }'
Error from server (BadRequest): error decoding patch: invalid character 's' looking for beginning of object key string
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> $patch = @"
>> {
>>   "spec": {
>>     "template": {
>>       "spec": {
>>         "affinity": {
>>           "podAffinity": {
>>             "preferredDuringSchedulingIgnoredDuringExecution": [
>>               {
>>                 "weight": 80,
>>                 "podAffinityTerm": {
>>                   "labelSelector": { "matchLabels": { "app": "jobs-api" } },
>>                   "topologyKey": "kubernetes.io/hostname"
>>                 }
>>               },
>>               {
>>                 "weight": 80,
>>                 "podAffinityTerm": {
>>                   "labelSelector": { "matchLabels": { "app": "applicants-api" } },
>>                   "topologyKey": "kubernetes.io/hostname"
>>                 }
>>               }
>>             ]
>>           }
>>         }
>>       }
>>     }
>>   }
>> }
>> "@
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices>
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod patch deployment webmvc --type merge -p $patch
Error from server (BadRequest): error decoding patch: invalid character 's' looking for beginning of object key string
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> $patch | Format-Hex -Count 64
Format-Hex : Impossible de trouver un paramètre correspondant au nom « Count ».
Au caractère Ligne:1 : 21
+ $patch | Format-Hex -Count 64
+                     ~~~~~~
    + CategoryInfo          : InvalidArgument : (:) [Format-Hex], ParameterBindingException
    + FullyQualifiedErrorId : NamedParameterNotFound,Format-Hex

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> $patch | Format-Hex


           00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F

00000000   7B 0A 20 20 22 73 70 65 63 22 3A 20 7B 0A 20 20  {.  "spec": {.
00000010   20 20 22 74 65 6D 70 6C 61 74 65 22 3A 20 7B 0A    "template": {.
00000020   20 20 20 20 20 20 22 73 70 65 63 22 3A 20 7B 0A        "spec": {.
00000030   20 20 20 20 20 20 20 20 22 61 66 66 69 6E 69 74          "affinit
00000040   79 22 3A 20 7B 0A 20 20 20 20 20 20 20 20 20 20  y": {.
00000050   22 70 6F 64 41 66 66 69 6E 69 74 79 22 3A 20 7B  "podAffinity": {
00000060   0A 20 20 20 20 20 20 20 20 20 20 20 20 22 70 72  .            "pr
00000070   65 66 65 72 72 65 64 44 75 72 69 6E 67 53 63 68  eferredDuringSch
00000080   65 64 75 6C 69 6E 67 49 67 6E 6F 72 65 64 44 75  edulingIgnoredDu
00000090   72 69 6E 67 45 78 65 63 75 74 69 6F 6E 22 3A 20  ringExecution":
000000A0   5B 0A 20 20 20 20 20 20 20 20 20 20 20 20 20 20  [.
000000B0   7B 0A 20 20 20 20 20 20 20 20 20 20 20 20 20 20  {.
000000C0   20 20 22 77 65 69 67 68 74 22 3A 20 38 30 2C 0A    "weight": 80,.
000000D0   20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
000000E0   22 70 6F 64 41 66 66 69 6E 69 74 79 54 65 72 6D  "podAffinityTerm
000000F0   22 3A 20 7B 0A 20 20 20 20 20 20 20 20 20 20 20  ": {.
00000100   20 20 20 20 20 20 20 22 6C 61 62 65 6C 53 65 6C         "labelSel
00000110   65 63 74 6F 72 22 3A 20 7B 20 22 6D 61 74 63 68  ector": { "match
00000120   4C 61 62 65 6C 73 22 3A 20 7B 20 22 61 70 70 22  Labels": { "app"
00000130   3A 20 22 6A 6F 62 73 2D 61 70 69 22 20 7D 20 7D  : "jobs-api" } }
00000140   2C 0A 20 20 20 20 20 20 20 20 20 20 20 20 20 20  ,.
00000150   20 20 20 20 22 74 6F 70 6F 6C 6F 67 79 4B 65 79      "topologyKey
00000160   22 3A 20 22 6B 75 62 65 72 6E 65 74 65 73 2E 69  ": "kubernetes.i
00000170   6F 2F 68 6F 73 74 6E 61 6D 65 22 0A 20 20 20 20  o/hostname".
00000180   20 20 20 20 20 20 20 20 20 20 20 20 7D 0A 20 20              }.
00000190   20 20 20 20 20 20 20 20 20 20 20 20 7D 2C 0A 20              },.
000001A0   20 20 20 20 20 20 20 20 20 20 20 20 20 7B 0A 20               {.
000001B0   20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 22                 "
000001C0   77 65 69 67 68 74 22 3A 20 38 30 2C 0A 20 20 20  weight": 80,.
000001D0   20 20 20 20 20 20 20 20 20 20 20 20 20 22 70 6F               "po
000001E0   64 41 66 66 69 6E 69 74 79 54 65 72 6D 22 3A 20  dAffinityTerm":
000001F0   7B 0A 20 20 20 20 20 20 20 20 20 20 20 20 20 20  {.
00000200   20 20 20 20 22 6C 61 62 65 6C 53 65 6C 65 63 74      "labelSelect
00000210   6F 72 22 3A 20 7B 20 22 6D 61 74 63 68 4C 61 62  or": { "matchLab
00000220   65 6C 73 22 3A 20 7B 20 22 61 70 70 22 3A 20 22  els": { "app": "
00000230   61 70 70 6C 69 63 61 6E 74 73 2D 61 70 69 22 20  applicants-api"
00000240   7D 20 7D 2C 0A 20 20 20 20 20 20 20 20 20 20 20  } },.
00000250   20 20 20 20 20 20 20 22 74 6F 70 6F 6C 6F 67 79         "topology
00000260   4B 65 79 22 3A 20 22 6B 75 62 65 72 6E 65 74 65  Key": "kubernete
00000270   73 2E 69 6F 2F 68 6F 73 74 6E 61 6D 65 22 0A 20  s.io/hostname".
00000280   20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 7D                 }
00000290   0A 20 20 20 20 20 20 20 20 20 20 20 20 20 20 7D  .              }
000002A0   0A 20 20 20 20 20 20 20 20 20 20 20 20 5D 0A 20  .            ].
000002B0   20 20 20 20 20 20 20 20 20 7D 0A 20 20 20 20 20           }.
000002C0   20 20 20 7D 0A 20 20 20 20 20 20 7D 0A 20 20 20     }.      }.
000002D0   20 7D 0A 20 20 7D 0A 7D                           }.  }.}


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get deploy webmvc -o yaml | Select-String -Pattern "affinity|podAffinity|preferredDuringScheduling"
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod patch deployment webmvc --type='merge' -p '{
>>   "spec": {
>>     "template": {
>>       "spec": {
>>         "affinity": {
>>           "podAffinity": {
>>             "preferredDuringSchedulingIgnoredDuringExecution": [
>>               {
>>                 "weight": 80,
>>                 "podAffinityTerm": {
>>                   "labelSelector": { "matchLabels": { "app": "jobs-api" } },
>>                   "topologyKey": "kubernetes.io/hostname"
>>                 }
>>               },
>>               {
>>                 "weight": 80,
>>                 "podAffinityTerm": {
>>                   "labelSelector": { "matchLabels": { "app": "applicants-api" } },
>>                   "topologyKey": "kubernetes.io/hostname"
>>                 }
>>               }
>>             ]
>>           }
>>         }
>>       }
>>     }
>>   }
>> }'
Error from server (BadRequest): error decoding patch: invalid character 's' looking for beginning of object key string
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> $PSVersionTable

Name                           Value
----                           -----
PSVersion                      5.1.26100.7462
PSEdition                      Desktop
PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}
BuildVersion                   10.0.26100.7462
CLRVersion                     4.0.30319.42000
WSManStackVersion              3.0
PSRemotingProtocolVersion      2.3
SerializationVersion           1.1.0.1


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> $patchObj = @{
>>   spec = @{
>>     template = @{
>>       spec = @{
>>         affinity = @{
>>           podAffinity = @{
>>             preferredDuringSchedulingIgnoredDuringExecution = @(
>>               @{
>>                 weight = 80
>>                 podAffinityTerm = @{
>>                   labelSelector = @{ matchLabels = @{ app = "jobs-api" } }
>>                   topologyKey   = "kubernetes.io/hostname"
>>                 }
>>               },
>>               @{
>>                 weight = 80
>>                 podAffinityTerm = @{
>>                   labelSelector = @{ matchLabels = @{ app = "applicants-api" } }
>>                   topologyKey   = "kubernetes.io/hostname"
>>                 }
>>               }
>>             )
>>           }
>>         }
>>       }
>>     }
>>   }
>> }
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices>
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> $patch = $patchObj | ConvertTo-Json -Depth 20
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod patch deployment webmvc --type merge -p $patch
Error from server (BadRequest): error decoding patch: invalid character 's' looking for beginning of object key string
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> {
>>   "spec": {
>>     "template": {
>>       "spec": {
>>         "affinity": {
>>           "podAffinity": {
>>             "preferredDuringSchedulingIgnoredDuringExecution": [
>>               {
>>                 "weight": 80,
>>                 "podAffinityTerm": {
>>                   "labelSelector": { "matchLabels": { "app": "jobs-api" } },
>>                   "topologyKey": "kubernetes.io/hostname"
>>                 }
>>               },
>>               {
>>                 "weight": 80,
>>                 "podAffinityTerm": {
>>                   "labelSelector": { "matchLabels": { "app": "applicants-api" } },
>>                   "topologyKey": "kubernetes.io/hostname"
>>                 }
>>               }
>>             ]
>>           }
>>         }
>>       }
>>     }
>>   }
>> }
Au caractère Ligne:2 : 9
+   "spec": {
+         ~
Jeton inattendu « : » dans l’expression ou l’instruction.
Au caractère Ligne:3 : 15
+     "template": {
+               ~
Jeton inattendu « : » dans l’expression ou l’instruction.
Au caractère Ligne:4 : 13
+       "spec": {
+             ~
Jeton inattendu « : » dans l’expression ou l’instruction.
Au caractère Ligne:5 : 19
+         "affinity": {
+                   ~
Jeton inattendu « : » dans l’expression ou l’instruction.
Au caractère Ligne:6 : 24
+           "podAffinity": {
+                        ~
Jeton inattendu « : » dans l’expression ou l’instruction.
Au caractère Ligne:7 : 62
+             "preferredDuringSchedulingIgnoredDuringExecution": [
+                                                              ~
Jeton inattendu « : » dans l’expression ou l’instruction.
Au caractère Ligne:9 : 25
+                 "weight": 80,
+                         ~
Jeton inattendu « : » dans l’expression ou l’instruction.
Au caractère Ligne:11 : 34
+                   "labelSelector": { "matchLabels": { "app": "jobs-ap ...
+                                  ~
Jeton inattendu « : » dans l’expression ou l’instruction.
Au caractère Ligne:11 : 51
+                   "labelSelector": { "matchLabels": { "app": "jobs-ap ...
+                                                   ~
Jeton inattendu « : » dans l’expression ou l’instruction.
Au caractère Ligne:11 : 60
+                   "labelSelector": { "matchLabels": { "app": "jobs-ap ...
+                                                            ~
Jeton inattendu « : » dans l’expression ou l’instruction.
Les erreurs d’analyse n’ont pas toutes été signalées. Corrigez les erreurs signalées, puis recommencez.
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
    + FullyQualifiedErrorId : UnexpectedToken

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> @'
>> {
>>   "spec": {
>>     "template": {
>>       "spec": {
>>         "affinity": {
>>           "podAffinity": {
>>             "preferredDuringSchedulingIgnoredDuringExecution": [
>>               {
>>                 "weight": 80,
>>                 "podAffinityTerm": {
>>                   "labelSelector": { "matchLabels": { "app": "jobs-api" } },
>>                   "topologyKey": "kubernetes.io/hostname"
>>                 }
>>               },
>>               {
>>                 "weight": 80,
>>                 "podAffinityTerm": {
>>                   "labelSelector": { "matchLabels": { "app": "applicants-api" } },
>>                   "topologyKey": "kubernetes.io/hostname"
>>                 }
>>               }
>>             ]
>>           }
>>         }
>>       }
>>     }
>>   }
>> }
>> '@ | Set-Content -Path patch.json -Encoding ascii
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod patch deployment webmvc --type merge --patch-file .\patch.json
deployment.apps/webmvc patched
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get deployment webmvc -o yaml | Select-String affinity -Context 0,30

>       affinity:
>         podAffinity:
            preferredDuringSchedulingIgnoredDuringExecution:
>           - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app: jobs-api
                topologyKey: kubernetes.io/hostname
              weight: 80
>           - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app: applicants-api
                topologyKey: kubernetes.io/hostname
              weight: 80
        containers:
        - image: tpfinal.azurecr.io/webmvc:1.0.0
          imagePullPolicy: IfNotPresent
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 20
            periodSeconds: 10
            successThreshold: 1
            tcpSocket:
              port: 80
            timeoutSeconds: 1
          name: webmvc
          ports:
          - containerPort: 80
            name: http
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            initialDelaySeconds: 10
            periodSeconds: 5
            successThreshold: 1
            tcpSocket:
              port: 80
            timeoutSeconds: 1
          resources:


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get deploy webmvc -o yaml | Select-String -Pattern "affinity|podAffinity|preferredDuringScheduling"

      affinity:
        podAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
          - podAffinityTerm:


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> @"
>> apiVersion: apps/v1
>> kind: Deployment
>> metadata:
>>   name: webmvc
>>   namespace: tp-prod
>>   labels:
>>     app: webmvc
>> spec:
>>   replicas: 2
>>   selector:
>>     matchLabels:
>>       app: webmvc
>>   template:
>>     metadata:
>>       labels:
>>         app: webmvc
>>     spec:
>>       affinity:
>>         podAffinity:
>>           preferredDuringSchedulingIgnoredDuringExecution:
>>             - weight: 80
>>               podAffinityTerm:
>>                 labelSelector:
>>                   matchLabels:
>>                     app: jobs-api
>>                 topologyKey: kubernetes.io/hostname
>>             - weight: 80
>>               podAffinityTerm:
>>                 labelSelector:
>>                   matchLabels:
>>                     app: applicants-api
>>                 topologyKey: kubernetes.io/hostname
>>       containers:
>>         - name: webmvc
>>           image: tpfinal.azurecr.io/webmvc:1.0.0
>>           imagePullPolicy: IfNotPresent
>>           ports:
>>             - containerPort: 80
>>               name: http
>>           resources:
>>             requests:
>>               cpu: "4m"
>>               memory: "900Mi"
>>             limits:
>>               cpu: "1"
>>               memory: "2000Mi"
>>           readinessProbe:
>>             tcpSocket:
>>               port: 80
>>             initialDelaySeconds: 10
>>             periodSeconds: 5
>>           livenessProbe:
>>             tcpSocket:
>>               port: 80
>>             initialDelaySeconds: 20
>>             periodSeconds: 10
>> ---
>> apiVersion: v1
>> kind: Service
>> metadata:
>>   name: webmvc
>>   namespace: tp-prod
>>   labels:
>>     app: webmvc
>> spec:
>>   type: ClusterIP
>>   selector:
>>     app: webmvc
>>   ports:
>>     - name: http
>>       port: 80
>>       targetPort: 80
>> "@ | Set-Content -Encoding UTF8 .\03-k8s-manifests\apps\webmvc.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl apply -f .\03-k8s-manifests\apps\webmvc.yaml
deployment.apps/webmvc configured
service/webmvc unchanged
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git add .\03-k8s-manifests\apps\webmvc.yaml
warning: in the working copy of '03-k8s-manifests/apps/webmvc.yaml', LF will be replaced by CRLF the next time Git touches it
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> git commit -m "(k8s): déploiement de  webmvc et des affinités aux APIs"

[main b588945] (k8s): déploiement de  webmvc et des affinités aux APIs
 1 file changed, 72 insertions(+)
 create mode 100644 03-k8s-manifests/apps/webmvc.yaml
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get pods -l app=webmvc -o wide
NAME                      READY   STATUS    RESTARTS   AGE     IP           NODE             NOMINATED NODE   READINESS GATES
webmvc-579b6d8484-67v8b   1/1     Running   0          4m5s    10.1.0.117   docker-desktop   <none>           <none>
webmvc-579b6d8484-jjgkv   1/1     Running   0          3m54s   10.1.0.118   docker-desktop   <none>           <none>
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod describe deploy webmvc | Select-String -Pattern "Affinity|podAffinity|preferred"
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n tp-prod get deploy webmvc -o yaml | Select-String -Pattern "affinity|podAffinity|preferredDuringSchedulingIgnoredDuringExecution" -Context 0,6

>       {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{},"labels":{"app":"webmvc"},"name":"webmvc","namespace":"tp-prod"},"spec":{"
replicas":2,"selector":{"matchLabels":{"app":"webmvc"}},"template":{"metadata":{"labels":{"app":"webmvc"}},"spec":{"affinity":{"podAffinity":{"preferredDur
ingSchedulingIgnoredDuringExecution":[{"podAffinityTerm":{"labelSelector":{"matchLabels":{"app":"jobs-api"}},"topologyKey":"kubernetes.io/hostname"},"weigh
t":80},{"podAffinityTerm":{"labelSelector":{"matchLabels":{"app":"applicants-api"}},"topologyKey":"kubernetes.io/hostname"},"weight":80}]}},"containers":[{
"image":"tpfinal.azurecr.io/webmvc:1.0.0","imagePullPolicy":"IfNotPresent","livenessProbe":{"initialDelaySeconds":20,"periodSeconds":10,"tcpSocket":{"port"
:80}},"name":"webmvc","ports":[{"containerPort":80,"name":"http"}],"readinessProbe":{"initialDelaySeconds":10,"periodSeconds":5,"tcpSocket":{"port":80}},"r
esources":{"limits":{"cpu":"1","memory":"2000Mi"},"requests":{"cpu":"4m","memory":"900Mi"}}}]}}}}
    creationTimestamp: "2025-12-24T10:18:43Z"
    generation: 3
    labels:
      app: webmvc
    name: webmvc
    namespace: tp-prod
>       affinity:
>         podAffinity:
>           preferredDuringSchedulingIgnoredDuringExecution:
>           - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app: jobs-api
                topologyKey: kubernetes.io/hostname
              weight: 80
>           - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app: applicants-api
                topologyKey: kubernetes.io/hostname
              weight: 80
        containers:


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
"ingress-nginx" has been added to your repositories
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> helm repo update
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the "ingress-nginx" chart repository
Update Complete. ⎈Happy Helming!⎈
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> helm install ingress-nginx ingress-nginx/ingress-nginx `
>>   --namespace ingress-nginx `
>>   --create-namespace
level=WARN msg="unable to find exact version; falling back to closest available version" chart=ingress-nginx requested="" selected=4.14.1
NAME: ingress-nginx
LAST DEPLOYED: Wed Dec 24 12:23:29 2025
NAMESPACE: ingress-nginx
STATUS: deployed
REVISION: 1
DESCRIPTION: Install complete
TEST SUITE: None
NOTES:
The ingress-nginx controller has been installed.
It may take a few minutes for the load balancer IP to be available.
You can watch the status by running 'kubectl get service --namespace ingress-nginx ingress-nginx-controller --output wide --watch'

An example Ingress that makes use of the controller:
  apiVersion: networking.k8s.io/v1
  kind: Ingress
  metadata:
    name: example
    namespace: foo
  spec:
    ingressClassName: nginx
    rules:
      - host: www.example.com
        http:
          paths:
            - pathType: Prefix
              backend:
                service:
                  name: exampleService
                  port:
                    number: 80
              path: /
    # This section is only required if TLS is to be enabled for the Ingress
    tls:
      - hosts:
        - www.example.com
        secretName: example-tls

If TLS is enabled for the Ingress, a Secret containing the certificate and key must also be provided:

  apiVersion: v1
  kind: Secret
  metadata:
    name: example-tls
    namespace: foo
  data:
    tls.crt: <base64 encoded cert>
    tls.key: <base64 encoded key>
  type: kubernetes.io/tls
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n ingress-nginx get pods
NAME                                        READY   STATUS    RESTARTS   AGE
ingress-nginx-controller-6c657c6487-b2mrm   1/1     Running   0          28s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> kubectl -n ingress-nginx get svc
NAME                                 TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)                      AGE
ingress-nginx-controller             LoadBalancer   10.99.57.136   localhost     80:32190/TCP,443:31103/TCP   41s
ingress-nginx-controller-admission   ClusterIP      10.98.44.58    <none>        443/TCP                      41s
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> mkdir .\03-k8s-manifests\security\certs


    Répertoire : C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices\03-k8s-manifests\security


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        24/12/2025     12:24                certs


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> openssl req -x509 -nodes -days 365 -newkey rsa:2048 `
>>   -keyout .\03-k8s-manifests\security\certs\tp-local.key `
>>   -out .\03-k8s-manifests\security\certs\tp-local.crt `
>>   -subj "/CN=tp.local/O=tp"
openssl : Le terme «openssl» n'est pas reconnu comme nom d'applet de commande, fonction, fichier de script ou programme exécutable. Vérifiez l'orthographe
du nom, ou si un chemin d'accès existe, vérifiez que le chemin d'accès est correct et réessayez.
Au caractère Ligne:1 : 1
+ openssl req -x509 -nodes -days 365 -newkey rsa:2048 `
+ ~~~~~~~
    + CategoryInfo          : ObjectNotFound: (openssl:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> winget install --id ShiningLight.OpenSSL
Aucun package ne correspond aux critères sélectionnés.
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> winget source update
Mise à jour en cours de toutes les sources... Merci de patienter.
Mise à jour de la source : msstore...
Terminé
Mise à jour de la source : winget...
Terminé
Mise à jour de la source : winget-font...
  ██████████████████████████████  100%
Terminé
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> winget install OpenSSL
Trouvé OpenSSL [ShiningLight.OpenSSL.Dev] Version 3.6.0
La licence d’utilisation de cette application vous est octroyée par son propriétaire.
Microsoft n’est pas responsable des paquets tiers et n’accorde pas de licences à ceux-ci.
Ce package nécessite les dépendances suivantes :
  - Packages
      Microsoft.VCRedist.2015+.x64
Téléchargement en cours https://slproweb.com/download/Win64OpenSSL-3_6_0.msi
  ██████████████████████████████   248 MB /  248 MB
Le code de hachage de l’installation a été vérifié avec succès
Démarrage du package d’installation... Merci de patienter.
Installé correctement
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> openssl version
openssl : Le terme «openssl» n'est pas reconnu comme nom d'applet de commande, fonction, fichier de script ou programme exécutable. Vérifiez l'orthographe
du nom, ou si un chemin d'accès existe, vérifiez que le chemin d'accès est correct et réessayez.
Au caractère Ligne:1 : 1
+ openssl version
+ ~~~~~~~
    + CategoryInfo          : ObjectNotFound: (openssl:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> winget search openssl
Nom                  ID                           Version Correspondance   Source
---------------------------------------------------------------------------------
OpenSSL              ShiningLight.OpenSSL.Dev     3.6.0                    winget
FireDaemon OpenSSL 3 FireDaemon.OpenSSL           3.6.0   Command: openssl winget
OpenSSL Light        ShiningLight.OpenSSL.Light   3.6.0   Command: openssl winget
FireDaemon Lozenge   FireDaemon.FireDaemonLozenge 3.1.3   Tag: openssl     winget
Stunnel              MichalTrojnara.Stunnel       5.76    Tag: openssl     winget
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> openssl version
openssl : Le terme «openssl» n'est pas reconnu comme nom d'applet de commande, fonction, fichier de script ou
programme exécutable. Vérifiez l'orthographe du nom, ou si un chemin d'accès existe, vérifiez que le chemin d'accès
est correct et réessayez.
Au caractère Ligne:1 : 1
+ openssl version
+ ~~~~~~~
    + CategoryInfo          : ObjectNotFound: (openssl:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> Get-ChildItem "C:\Program Files\OpenSSL*" -Directory


    Répertoire : C:\Program Files


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        24/12/2025     12:30                OpenSSL-Win64


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> Get-ChildItem "C:\Program Files\OpenSSL-Win64\bin\openssl.exe"


    Répertoire : C:\Program Files\OpenSSL-Win64\bin


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        08/10/2025     15:15         819712 openssl.exe


PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> "C:\Program Files\OpenSSL-Win64\bin\openssl.exe" version
Au caractère Ligne:1 : 50
+ "C:\Program Files\OpenSSL-Win64\bin\openssl.exe" version
+                                                  ~~~~~~~
Jeton inattendu « version » dans l’expression ou l’instruction.
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
    + FullyQualifiedErrorId : UnexpectedToken

PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices> & "C:\Program Files\OpenSSL-Win64\bin\openssl.exe" version
OpenSSL 3.6.0 1 Oct 2025 (Library: OpenSSL 3.6.0 1 Oct 2025)
PS C:\Users\Dimitri ANGELY\Desktop\laboratoire\Leclerc-vincent\tp-k8s-microservices>